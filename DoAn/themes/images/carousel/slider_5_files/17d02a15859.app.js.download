(()=>{var e,t,i={7460:e=>{var t="Content-Type",i="application/x-www-form-urlencoded",n="application/json; charset=utf-8";function r(e,t){return Object.assign(e.clone(),t)}function s(e){return(e||"").trim()}function o(e){return e&&"[object Function]"==={}.toString.call(e)}function a(e,t,i){if(!e||0===e.length)return i(t);var n=e.shift();if(!o(n))return a(e,t,i);n(t,(function(n){return!1===n?i(t):a(e,t,i)}))}function c(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16)}))}function u(e){if(!e)return"";for(var t=Object.keys(e),i=[],n=0;n<t.length;n++){var r=t[n],s="",o=e[r];if(void 0!==o){if(null===o)s=c(r);else if(Array.isArray(o)){for(var a=[],u=0;u<o.length;u++)void 0!==o[u]&&(a.push(l(r,o[u],a.length)),a.push(i));s=a.join("&")}else s=c(r)+"="+c(o);s.length>0&&i.push(s)}}return i.join("&")}function l(e,t){return null===t?c(e):[c(e),"=",c(t)].join("")}var h,d=(h={parser:"",beforehooks:[],afterhooks:[],baseurl:"",query:{},meta:{},clone:function(){return Object.assign({},this,{query:Object.assign({},this.query),meta:Object.assign({},this.meta)})},addQuery:function(e,t){var i=this.clone();return i.query[e]=t,i},removeQuery:function(e){var t=this.clone();return void 0!==t.query[e]&&(t.query[e]=void 0),t},withCredentials:function(e){return r(this,{_withCredentials:e})},setQuery:function(e){return r(this,{query:e})},clearHooks:function(){return r(this,{beforehooks:[],afterhooks:[]})},beforeHook:function(e){var t=this.beforehooks.slice();return t.push(e),r(this,{beforehooks:t})},afterHook:function(e){var t=this.afterhooks.slice();return t.push(e),r(this,{afterhooks:t})},setHeader:function(e){return(e=Object.assign({},this.headers,e))[t]=void 0,r(this,{headers:e})}},["put","head","patch","delete","post","get"].map((function(e){h[e]=function(c,l,h){return function(e,r,s){s=s||function(){},o(r)&&(s=r,r=void 0);var c,l=new Promise((function(e){c=function(t){try{s(t.error,t.body,t.code)}catch(e){}e(t)}}));return r&&((e=e.clone()).body=r,e.content_type===n&&(e.body=p.Jsonify(r)),e.content_type===i&&(e.body=u(r))),a(e.beforehooks.slice(),{request:e},(function(i){if(i.error)return c({body:void 0,code:0,error:i.error});!function(e,i){let n=u(e.query);if(n&&(n="?"+n),!p.XMLHttpRequest)return function(e,i,n){var r=Object.assign({},e.headers);e.content_type&&(r[t]=e.content_type),fetch(e.baseurl+n,{method:e.method,headers:r,credentials:e._withCredentials,body:e.body}).then((e=>e.text().then((t=>i(void 0,t,e.status))))).catch((e=>i("network_error",e,-1)))}(e,i,n);var r=new p.XMLHttpRequest;for(var s in r.onreadystatechange=function(e){4===r.readyState&&(0===r.status?i("network_error",r.responseText,r.status):i(void 0,r.responseText,r.status))},r.open(e.method,e.baseurl+n),r.withCredentials=e._withCredentials,e.headers)r.setRequestHeader(s,e.headers[s]);e.content_type&&r.setRequestHeader(t,e.content_type),r.send(e.body)}(i.request,(function(t,i,n){a(e.afterhooks.slice(),{request:e,code:n,body:i,err:t},(function(t){var i=t.body;if("json"==e.parser&&t.body)try{i=p.ParseJson(t.body)}catch(e){t.err=t.err||"invalid json"}var r=t.err;(n<200||n>299)&&(r="not 200"),c({body:i,code:t.code,error:r})}))}))})),l}(r(this,{method:e,baseurl:(d=this.baseurl,f=c,d=s(d),(f=s(f))&&d?f.startsWith("http://")||f.startsWith("https://")||f.startsWith("//")?f:(d.endsWith("/")||(d+="/"),f.startsWith("/")&&(f=f.substring(1)),d+f):d+f)}),l,h);var d,f}})),h.setBaseUrl=function(e){return r(this,{baseurl:e})},h.contentTypeJson=function(){return r(this,{content_type:n})},h.contentTypeForm=function(){return r(this,{content_type:i})},h.setContentType=function(e){return r(this,{content_type:s(e)})},h.setParser=function(e){return r(this,{parser:s(e)})},h.setBody=function(e){return r(this,{body:e})},h.setMeta=function(e,t){var i=this.clone();return i.meta[e]=t,i},h),p={Jsonify:JSON.stringify,ParseJson:JSON.parse};d.env=p,d.waterfall=a,e.exports=d},5530:(e,t,i)=>{var n=i(8368);e.exports=function(e,t,i){var r=[],s="idle",o=function(e){var t=e.map((function(e){return e.payload})),n=i(t);n&&n.then||(n=Promise.resolve(n));var r=e.map((function(e){return e.rs}));return new Promise((function(e){n.then((function(t){r.map((function(e,i){e(t&&t[i])})),e()}))}))},a=function(){"executing"!==s&&(s="executing",n((function(){if(r.length<=e)return Promise.resolve(!1);var t=r.splice(0,e);return o(t).then((function(){return!0}))})).then((function(){if(0!==r.length){var e=t-(Date.now()-r[0].created);if(e>=1){if(s="idle",r[0].settedTimeout)return;return r[0].settedTimeout=!0,void setTimeout(a,e)}var i=r;r=[],o(i).then((function(){s="idle",a()}))}else s="idle"})))};return this.push=function(e,t){return new Promise((function(i){r.push({payload:e,priority:t,created:Date.now(),rs:i}),a()}))},this}},3538:e=>{e.exports={map:function(e,t){if(!e)return[];t||(t=function(e){return e});var i=[];if(Array.isArray(e)){for(var n=0;n<e.length;n++)i.push(t(e[n],n));return i}if("object"==typeof e){var r=Object.keys(e);for(n=0;n<r.length;n++){var s=r[n];i.push(t(e[s],s))}return i}return i}}},3165:(e,t,i)=>{var n=i(2349),r=i(8368),s=i(8874),o=i(5530);e.exports={sleep:n,loop:r,map:s,batch:o}},8368:e=>{e.exports=function e(t){var i=t();if(!i||!i.then){var n=i;i={then:function(e){e(n)}}}return i.then((function(i){return i?e(t):Promise.resolve()}))}},8874:(e,t,i)=>{var n=i(3538);e.exports=function(e,t,i){if("number"==typeof t){let e=i;i=t,t=e}t||(t=function(){}),("number"!=typeof i||i<=0)&&(i=1);var r={};if(n.map(e,(function(e,t){r[t]=e})),i<=0&&(i=1),0===Object.keys(r).length)return Promise.resolve([]);Object.keys(r).length<i&&(i=Object.keys(r).length);var s={};return new Promise((function(e){let o=Object.keys(r).length;for(var a=function(){var i=Object.keys(r);if(0!==i.length){var c=i.pop(),u=r[c];delete r[c];var l=t(u,c);l&&l.then||(l=Promise.resolve(l)),l.then((function(t){if(s[c]=t,Object.keys(s).length===o)return e(n.map(s));a()}))}},c=0;c<i;c++)setTimeout(a,1)}))}},2349:e=>{e.exports=function(e){return new Promise((function(t){setTimeout(t,e)}))}},8454:(e,t,i)=>{e.exports=i(608)},608:(e,t,i)=>{var n=i(3165);function r(e,t,i,r,a){a=a||s,t=t||{};var d=!1,p="";this.kill=function(){d=!0};var f=function(t){d||a("get",e+"poll?token="+p,void 0,(function(n,s){if(!d){if(u(s))return setTimeout(f,c(t),t+1);if(200!==s)return d=!0,i("poll");(n=o(n)||{}).host&&(e=h(n.host));var a=n.sequential_token;return a?(p=a,r(n.events||[]),f(0)):setTimeout(f,c(t),t+1)}}))},g=n.batch(50,100,(function(r){if(d)return["dead"];if(r.length<=0)return[];var s=[];return n.loop((function(){return new Promise((function(n){var c="?token="+p;t.getAccessToken().then((function(g){t.user_mask?c+="&user-mask="+encodeURIComponent(t.user_mask):g&&(c+="&access-token="+g),a("post",e+"subs"+c,JSON.stringify({events:r}),(function(t,a){if(d)return s=l("dead",r.length),n(!1);if(u(a))return setTimeout(n,3e3,!0);if(200!==a)return d=!0,i("subscribe",t,a),s=l("dead",r.length),n(!1);if(p)return n(!1);var c=(t=o(t)||{}).initial_token;return c?(t.host&&(e=h(t.host)),p=c,f(0),n(!1)):setTimeout(n,3e3,!0)}))}))}))})).then((function(){return s}))}));this.subscribe=g.push.bind(g)}var s=function(e,t,i,n){if("undefined"==typeof XMLHttpRequest)return function(e,t,i,n){let r={};i&&(r["content-type"]="text/plain"),fetch(t,{method:e,headers:r,body:i}).then((e=>e.text().then((t=>n&&n(t,e.status))))).catch((e=>n&&n(e,-1)))}(e,t,i,n);var r=new XMLHttpRequest;r.onreadystatechange=function(e){4===r.readyState&&(n&&n(r.responseText,r.status),n=void 0)},r.onerror=function(){n&&n(r.responseText,-1),n=void 0},r.open(e,t),i&&r.setRequestHeader("content-type","text/plain"),r.send(i)};function o(e){try{return JSON.parse(e)}catch(e){}}function a(){var e={};this.emit=function(t){for(var i=[],n=1;n<arguments.length;n++)i.push(arguments[n]);var r=e[t];if(r)for(n=0;n<r.length;n++)r[n].apply(void 0,i)},this.on=function(t,i){e[t]||(e[t]=[]),e[t].push(i)}}function c(e){if(!e||-1===e)return 0;var t=1e3*Math.pow(1.5,e);return Math.min(1e4,t)}function u(e){return e>=500&&e<600||0===e||-1===e||429===e}function l(e,t){for(var i=[],n=0;n<t;n++)i.push(e);return i}function h(e){return(e=e||"").startsWith("//")?"https:"+e:e}e.exports=function(e,t,i){("string"==typeof e||e instanceof String)&&(e=[e]),(t=t||{}).getAccessToken||(t.getAccessToken=function(){return Promise.resolve("")});var n,s=new a,o={},c=!1;this.stop=function(){c||(c=!0,n.kill())},this.onEvent=function(e){return s.on("event",e)},this.onInterrupted=function(e){return s.on("interrupted",e)},this.subscribe=function(e){if(c)return Promise.resolve({});if("string"==typeof e&&(e=[e]),!Array.isArray(e))return Promise.resolve({error:"param should be an array or string"});for(var t=[],i=0;i<e.length;i++){var r=e[i];r&&(o[r]||t.push(n.subscribe(r)))}return 0===t.length?Promise.resolve({}):Promise.all(t).then((function(t){for(var i=0;i<t.length;i++)if(t[i])return{error:t[i]};for(var n=0;n<e.length;n++)o[e[n]]=!0;return{}}))};var u=function(){if(!c){for(var a=Object.keys(o),l=0;l<a.length;l++)o[a[l]]=!1;var h=e[Math.floor(Math.random()*e.length)];n=new r(h,t,(function(e,t,i){c||(s.emit("interrupted",e,t,i),setTimeout(u,2e3))}),(function(e){if(!c)for(var t=0;t<e.length;t++)s.emit("event",e[t])}),i);var d=Object.keys(o);for(l=0;l<d.length;l++)n.subscribe(d[l])}};u()}},4636:e=>{e.exports={ApiURL:"https://api.sbz.vn/4.0",RealtimeURL:"https://api.sbz.vn/rt/0/",FileURL:"https://vcdn.subiz-cdn.com/file/",BaseURL:"https://widget.sbz.vn"}},4878:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});class n{constructor(e,t,i){this.schema=t+"_chain",this.dead=!1,this.db=e,this.anchorCache={},this.cache={},this.init()}init(){let e={};this.db.all("items").map((t=>{e[t.chain]=e[t.chain]||{},e[t.chain][t.id]={id:t.id,chain:t.chain,full_id:t.full_id,index:t.index,value:t.value}})),s(e,((t,i)=>{if(((n=t)?void 0!==n.length?n.length:Object.keys(n).length:0)<50)return;var n;let r=(o=s(t),a=["index"],"desc",c=[],s(o,(e=>c.push(e))),c.sort(((e,t)=>{if(e[a]===t[a])return 0;var i=e[a]<t[a]?-1:1;return-i})),c);var o,a,c;let u=[];for(var l=50;l<r.length;l++)u.push(r[l].full_id),delete t[r[l].id];this.db.removes("items",u),e[i]=t})),this.cache=e}destroy(){this.db.clear("items"),this.dead=!0,this.cache={},this.anchorCache={},this.db=void 0}put(e,t,i,n){if(this.dead)return;let s=this.cache[e]||{},o=(r(s)||{}).index||"z",a={id:t,index:i,value:n,chain:e,full_id:e+":"+t};delete s[a.id],o>a.index+""||(s[a.id]=a,this.cache[e]=s,this.db.put("items",a.full_id,a))}listM(e){if(this.dead)return{};let t=this.cache[e]||{},i={};return s(t,((e,t)=>{i[t]=e.value})),i}async fetchMore(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=arguments.length>2?arguments[2]:void 0;if(this.dead)return{error:"dead"};if(!i)return{error:"no api"};let n=this.anchorCache[e]||"";var[r,s,o]=await i(e,n,t);if(o)return{error:o};if(this.dead)return{error:"dead"};let a=this.cache[e]||{};return 0===r.length?{end:!0}:(r.forEach((t=>{t.chain=e,t.full_id=e+":"+t.id,a[t.id]=t,this.db.put("items",t.full_id,t)})),this.anchorCache[e]=s,this.cache[e]=a,{})}del(e,t){if(this.dead)return;let i=e+":"+t;delete(this.cache[e]||{})[t],this.db.removes("items",[i])}match(e,t){return this.listM(e)[t]}async reload(e,t){if(this.dead)return;let i=function(e){if(!e)return;let t=Object.keys(e);if(!t.length)return;let i=-1/0,n=Object.keys(e)[0];for(var r=0;r<t.length;r++){let s=e[t[r]]&&e[t[r]].index||-1/0;s>i&&(i=s,n=t[r])}return e[t[n]]}(this.listM(e))||{},n=i.index;n||(n=Date.now());for(var o="",a={};;){if(this.dead)return;let[i,c,u]=await t(e,o,50);if(u)return;if(this.dead)return;if(i.map((t=>{a[t.id]=Object.assign({},t,{chain:e,full_id:e+":"+t.id})})),0===i.length||c===o)break;if(a.length>=200){let t=this.cache[e]||{},i=[];s(t,(t=>{t.chain===e&&i.push(t.full_id)})),this.db.removes("items",i),this.cache[e]={};break}if((r(a)||{}).index<=n){o=this.anchorCache[e]||c;break}o=c}for(var c=0;c<Object.keys(a).length;c++){let e=a[Object.keys(a)[c]];this.db.put("items",e.full_id,e),this.cache[e.chain]=this.cache[e.chain]||{},this.cache[e.chain][e.id]=e}this.anchorCache[e]=o}}function r(e){if(!e)return;let t=Object.keys(e);if(!t.length)return;let i=1/0,n=Object.keys(e)[0];for(var r=0;r<t.length;r++){let s=e[t[r]]&&e[t[r]].index||1/0;s<i&&(i=s,n=t[r])}return e[n]}function s(e,t){if(!e)return[];if(!t)return e;var i=[];if(Array.isArray(e)){for(let n=0;n<e.length;n++)i.push(t(e[n],n));return i}if("object"==typeof e){var n=Object.keys(e);for(let s=0;s<n.length;s++){var r=n[s];i.push(t(e[r],r))}return i}return i}},9489:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n={},r={};n.length=0,n.getItem=function(e){return e in r?r[e]:null},n.setItem=function(e,t){void 0===t?n.removeItem(e):r[e]=""+t,n.length=Object.keys(r).length},n.removeItem=function(e){Object.prototype.hasOwnProperty.call(r,e)&&(delete r[e],n.length=Object.keys(r).length)},n.key=function(e){return Object.keys(r)[e]||null},n.clear=function(){r={},n.length=0};const s=n},1606:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n=class{constructor(e,t){this.name=t,t+="_kv",this.dead=!1,this.db=e,this.cache={},this.initialized=!1,this.init()}refreshCache(){if(this.dead)return;let e={};this.db.all("items").forEach((function(t){e[t.key]=t.value})),this.cache=e}init(){if(this.initialized)return;let e={};console.time("KV"+this.name),this.db.all("items").forEach((function(t){e[t.key]=t.value})),this.cache=e;let t=Object.keys(this.cache);if(t.length>500){let e=250/t.lenth,n=[];for(var i=0;i<500;i++){if(Math.random()<=e)continue;let r=t[i];delete this.cache[r],n.push(r)}this.db.removes("items",[n])}this.initialized=!0,console.timeEnd("KV"+this.name)}all(){return this.dead?[]:this.initialized?this.cache:[]}match(e){if(!this.dead&&this.initialized&&e)return this.cache[e]}put(e,t){if(e){if(this.dead)return[];if(!this.initialized)throw new Error("uninitialized");this.cache[e]=t,this.db.put("items",e,{key:e,value:t})}}del(e){if(!this.dead){if(!this.initialized)throw new Error("uninitialized");delete this.cache[e],this.db.removes("items",[e])}}destroy(){this.db.clear("items"),this.dead=!0,this.db=void 0,this.cache=void 0,this.initialized=!1}}},6929:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});let n=i(9489).Z,r=window.requestIdleCallback||(e=>e());const s=class{constructor(e,t){if(this.localStorage=n,this.allkeys={},!t)try{window.localStorage.setItem("sbzstore1029","?"),window.localStorage.removeItem("sbzstore1029"),this.localStorage=window.localStorage}catch(e){}this.schema=e}all(e){let t=[];for(var i=0;i<this.localStorage.length;i++){let n=this.localStorage.key(i);n.startsWith(this.schema+"#"+e+"#")&&(this.allkeys[n]=!0,t.push(JSON.parse(this.localStorage.getItem(n))))}return t}removes(e,t){for(var i=0;i<t.length;i++)delete this.allkeys[this.schema+"#"+e+"#"+t[i]],this.localStorage.removeItem(this.schema+"#"+e+"#"+t[i])}clear(e){let t=[];for(var i=0;i<this.localStorage.length;i++){let n=this.localStorage.key(i);n.startsWith(this.schema+"#"+e+"#")&&t.push(n)}for(i=0;i<t.length;i++)this.localStorage.removeItem(t[i]);this.allkeys={}}put(e,t,i){this.allkeys[this.schema+"#"+e+"#"+t]=!0,Object.keys(this.allkeys).length>80&&this.clear(e),r((()=>{try{this.localStorage.setItem(this.schema+"#"+e+"#"+t,void 0===(n=i)?"null":JSON.stringify(n))}catch(t){this.clear(e)}var n}))}}},8733:(e,t,i)=>{"use strict";i.r(t),i.d(t,{parseJSON:()=>r,stringify:()=>o,Date:()=>c,requestAnimationFrame:()=>u,setTimeout:()=>l,setInterval:()=>h,convoOfEv:()=>d,convoToEv:()=>p,setMsgField:()=>f,getMsgField:()=>g,merge:()=>m,cloneDeep:()=>v,randomString:()=>y,filter:()=>b,includes:()=>w,map:()=>k,each:()=>x,usersOfConvo:()=>Z,isConvoSeen:()=>C,agentsOfConvo:()=>z,startsWith:()=>S,size:()=>A,replaceAll:()=>O,trim:()=>j,trimStart:()=>P,throttle:()=>M,find:()=>E,orderBy:()=>L,getIntegrationId:()=>U,isPhone:()=>q,isURL:()=>I,isNumber:()=>R,isEmail:()=>D,last:()=>W,getAgentDisplayName:()=>$,isUserBanned:()=>G,setUserAttr:()=>F,getUserAttr:()=>H,norm:()=>B,noop:()=>N,replaceCssVariablePlugin:()=>Q,replaceCssVariable:()=>J,tokenize:()=>X,setCss:()=>Y,DEF_CHAT_BUTTON_BACKGROUND_IMAGE_URL:()=>K,DEFVAL:()=>ee,js2css:()=>te,checkRunConditions:()=>ne,getDayName:()=>se,preloadWebfonts:()=>ae,preloadImg:()=>ce,offsetToMin:()=>ue,diffDay:()=>le,diffYear:()=>he,sameDay:()=>de,shortTime:()=>pe,unixSec:()=>fe,getMs:()=>ge,detectLang:()=>_e,getUrlParameter:()=>me,sleep:()=>ve});var n=i(6877);function r(e){try{return a(e)}catch(e){}}var s=document.createElement("iframe");s.style.display="none",document.documentElement.appendChild(s);var o=s.contentWindow.JSON.stringify,a=s.contentWindow.JSON.parse,c=s.contentWindow.Date,u=s.contentWindow.requestAnimationFrame,l=s.contentWindow.setTimeout,h=s.contentWindow.setInterval;function d(e){if(!e)return"";switch(e.type){case"conversation_state_updated":case"conversation_joined":case"conversation_invited":case"conversation_left":case"conversation_tagged":case"conversation_untagged":case"conversation_typing":case"conversation_rating_requested":case"conversation_rated":return n.get(e,"data.conversation.id");case"message_sent":case"message_updated":case"message_pong":return n.get(e,"data.message.conversation_id");case"ticket_updated":return n.get(e,"data.ticket.conversation_id");default:return""}}function p(e,t){if(!t)return"";switch(t.type){case"conversation_state_updated":case"conversation_joined":case"conversation_invited":case"conversation_left":case"conversation_tagged":case"conversation_untagged":case"conversation_typing":case"conversation_rating_requested":case"conversation_rated":return n.set(t,"data.conversation.id",e);case"message_sent":case"message_updated":case"message_pong":return n.set(t,"data.message.conversation_id",e);case"ticket_updated":return n.set(t,"data.ticket.conversation_id",e);default:return""}}function f(e,t,i){var r=n.get(e,"data.message.fields")||[];(r=b(r,(e=>e.key!==t))).push({key:t,value:o(i)}),n.set(e,"data.message.fields",r)}function g(e,t){var i=n.get(e,"data.message.fields");if(0===A(i))return;let r=i.find((e=>e.key===t));try{return r?a(r.value):void 0}catch(e){}}function _(e){return e&&"object"==typeof e&&!Array.isArray(e)}function m(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];if(!i.length)return e;const r=i.shift();if(_(e)&&_(r))for(const t in r)_(r[t])?(e[t]||Object.assign(e,{[t]:{}}),m(e[t],r[t])):Object.assign(e,{[t]:r[t]});return m(e,...i)}function v(e){if(e!==Object(e))return e;var t=o(e);return void 0!==t?a(t):void 0}function y(e){var t,i="";(!e||e<1)&&(e=10);for(var n=0;n<e;n++)t=Math.floor(25*Math.random()+97),i+=String.fromCharCode(t);return i}function b(e,t){if(!e)return[];if(!t)return e;var i=[];if(Array.isArray(e)){for(let n=0;n<e.length;n++)t(e[n],n)&&i.push(e[n]);return i}if("object"==typeof e){var n=Object.keys(e);for(let s=0;s<n.length;s++){var r=n[s];t(e[r],r)&&i.push(e[r])}return i}return i}function w(e,t){if(!e)return!1;var i="string"==typeof e||e instanceof String;return!(!Array.isArray(e)&&!i)&&e.includes(t)}function k(e,t){if(!e)return[];t||(t=e=>e);var i=[];if(Array.isArray(e)){for(let n=0;n<e.length;n++)i.push(t(e[n],n));return i}if("object"==typeof e){var n=Object.keys(e);for(let s=0;s<n.length;s++){var r=n[s];i.push(t(e[r],r))}return i}return i}function x(e,t){return k(e,t)}function Z(e){return e?k(b(e.members,(e=>"user"===e.type)),(e=>e.id)):[]}function C(e,t){if("ended"===e.state)return!0;let i=e.last_message_sent;if(!i)return!0;if(n.get(i,"by.id")===t)return!0;let r=E(e.members,(e=>e.id===t));return!r||ge(i.created)<ge(r.seen_at)}function z(e,t){return e?k(b(e.members,(e=>t?"agent"===e.type||"bot"===e.type:"agent"===e.type)),(e=>e.id)):[]}function S(e,t){return((e||"")+"").startsWith(t)}function A(e){return e?void 0!==e.length?e.length:Object.keys(e).length:0}function O(e,t,i){return(e||"").split(t).join(i)}function j(e,t){return((e||"")+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function P(e,t){for(e=(e||"")+"";e.charAt(0)===t;)e=e.substr(1);return e}function M(e,t,i){var n,r,s,o=null,a=0;i||(i={});var u=function(){a=!1===i.leading?0:(new c).getTime(),o=null,s=e.apply(n,r),o||(n=r=null)};return function(){var h=(new c).getTime();a||!1!==i.leading||(a=h);var d=t-(h-a);return n=this,r=arguments,d<=0||d>t?(o&&(clearTimeout(o),o=null),a=h,s=e.apply(n,r),o||(n=r=null)):o||!1===i.trailing||(o=l(u,d)),s}}function E(e,t){if(e)return e[T(e,t)]}function T(e,t){if(!e)return-1;if(!t)return-1;if(Array.isArray(e)){for(let i=0;i<e.length;i++)if(t(e[i],i))return i;return-1}if("object"==typeof e){var i=Object.keys(e);for(let r=0;r<i.length;r++){var n=i[r];if(t(e[n],n))return n}}return-1}function L(e,t,i){var n=[];return x(e,(e=>n.push(e))),n.sort(((e,n)=>{if(e[t]===n[t])return 0;var r=e[t]<n[t]?-1:1;return"desc"===i?-r:r})),n}function U(e){return`${e}.subizv4.subikon`}function q(e){return/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(String(e))}function I(e){return/[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/gi.test(String(e).toLowerCase())}function R(e){return re.test(String(e))}function D(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}function W(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}function $(e,t){return n.get(t,"fullname")||n.get(t,"email")||n.get(e,"name")||"Agent"}function G(e){return H(e,"is_ban","boolean")}function F(e,t){if(e&&n.get(t,"key")){e.attributes=e.attributes||[];var i=T(e.attributes,(e=>e.key===t.key));-1!==i?e.attributes[i]=t:e.attributes.push(t)}}function H(e,t,i){if(!e||!e.attributes)return;let n;return x(e.attributes,(e=>{e&&e.key===t&&("datetime"===i&&(n=e.datetime),"boolean"===i&&(n=e.boolean),"number"===i&&(n=e.number),"text"===i&&(n=e.text),"list"===i&&(n=e.list))})),n}function B(e){return(e=e||"").trim().toLowerCase()}function N(){}function V(e){return("string"==typeof e||e instanceof String)&&(e=e.trim().replace(/;+$/,"")),e}function Q(e,t){var i=[e];let r=t.spacer||10;t=Object.assign({},t,{spacer:r+"px",spacer0:r/2+"px",spacer2:2*r+"px",spacer3:3*r+"px"}),i=X(i,"'@font_family'"),i=X(i,"'@font_size'"),i=X(i,"'@text_color'"),i=X(i,"'@faded_text_color'"),i=X(i,"'@primary_color'"),i=X(i,"'@background'"),i=X(i,"'@spacer'"),i=X(i,"'@spacer0'"),i=X(i,"'@spacer2'"),i=X(i,"'@spacer3'");for(var s=[],o=0;o<i.length;o++){var a=i[o];if("string"!=typeof a){var c=a.type.substr(2,a.type.length-3),u=n.get(t,c)||n.get(ee,c)||"";s.push(u)}else s.push(a)}return s.join("")}function J(e,t){var i=[e];i=X(i,"'@primary_color'"),i=X(i,"@esc-primary-color-esc"),i=X(i,"'@secondary_color'"),i=X(i,"'@background'"),i=X(i,"'@text_color'"),i=X(i,"'@width'"),i=X(i,"'@height'"),i=X(i,"'@desktop_button.width'"),i=X(i,"'@desktop_button.height'"),i=X(i,"'@desktop_button.background'"),i=X(i,"'@desktop_button.border_radius'"),i=X(i,"'@desktop_button.margin_x'"),i=X(i,"'@desktop_button.margin_y'"),i=X(i,"'@mobile_button.width'"),i=X(i,"'@mobile_button.height'"),i=X(i,"'@mobile_button.background'"),i=X(i,"'@mobile_button.border_radius'"),i=X(i,"'@mobile_button.margin_x'"),i=X(i,"'@mobile_button.margin_y'"),i=X(i,"'@widget_position'"),i=X(i,"'@z_index'"),i=X(i,"'@z_index_2'"),i=X(i,"'@z_index_3'"),i=X(i,"'@z_index_4'"),i=X(i,"'@z_index_5'");for(var r=[],s=0;s<i.length;s++){var o=i[s];if("string"!=typeof o)if("@esc-primary-color-esc"!==o.type)if("'@z_index_2'"!==o.type)if("'@z_index_3'"!==o.type)if("'@z_index_4'"!==o.type)if("'@z_index_5'"!==o.type){var a=o.type.substr(2,o.type.length-3);c=V(c=n.get(t,a)||n.get(ee,a)||""),["mobile_button.width","mobile_button.height","mobile_button.margin_x","mobile_button.margin_y","desktop_button.width","desktop_button.height","desktop_button.margin_x","desktop_button.margin_y","width","height"].includes(a)&&(c+="px"),"height"!==a||"full"!==n.get(t,"window_mode")?r.push(c):r.push("100%")}else c=n.get(t,"z_index")||n.get(ee,"z_index"),r.push(c+5);else c=n.get(t,"z_index")||n.get(ee,"z_index"),r.push(c+4);else{var c=n.get(t,"z_index")||n.get(ee,"z_index");r.push(c+3)}else{c=n.get(t,"z_index")||n.get(ee,"z_index");r.push(c+2)}else{c=n.get(t,"primary_color")||n.get(ee,"primary_color");r.push(encodeURIComponent(V(c)))}else r.push(o)}return r.join("")}function X(e,t){if(!e||!e.length)return[];var i=[];for(let s=0;s<e.length;s++){var n=e[s];if("string"==typeof n){var r=n.split(t);for(let e=0;e<r.length;e++)i.push(r[e]),i.push({type:t});i.pop()}else i.push(n)}return i}function Y(e,t,i){i=O(i,"#sbz92","#"+e),t.styleSheet?t.styleSheet.cssText=i:(t.innerHTML="",t.appendChild(document.createTextNode(i)))}const K="https://file-subiz.com/bubble_11.svg",ee={primary_color:"#0265FF",secondary_color:"#555555",background:"linear-gradient(280.16deg, #0053d3 22.03%, #0265ff 78.2%)",text_color:"white",width:375,height:705,window_mode:"mini",desktop_button:{width:.3,height:.3,border_radius:"100%",background_mask_url:K,margin_x:.3,margin_y:.3},mobile_button:{width:.3,height:.3,border_radius:"100%",background_mask_url:K,margin_x:.3,margin_y:.3},widget_position:"fixed",z_index:2e9};function te(e,t,i){var n={};for(var r in e)e.hasOwnProperty(r)&&(t&&t.length>0&&-1===t.indexOf(r)||("string"==typeof e[r]?n[r]=j(e[r]):n[r]=e[r]));e=n;let s="";for(var r in e)if(e.hasOwnProperty(r)){var o="";if(e.blur&&(o+="blur("+e.blur+") "),e.grayscale&&(o+="grayscale("+e+") "),o&&(s+="filter: "+o+"!important;"),void 0!==e.rotate&&(s+="transform:rotate("+e.rotate+") !important;"),void 0!==e[r]){let t=e[r]+"";k(i,((e,i)=>{-1!==t.indexOf(i)&&(t=O(t,i,e))})),s+=O(r,"_","-")+":"+t+" !important;","color"===r&&(s+="-webkit-text-fill-color: "+t+" !important;")}}return s}function ie(){var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t="undefined"!=typeof InstallTrigger,i=(/constructor/i.test(window.HTMLElement)||(!window.safari||"undefined"!=typeof safari&&window.safari.pushNotification).toString(),!!document.documentMode),n=!i&&!!window.StyleMedia,r=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime);r||(r=navigator.userAgent.indexOf("Chrome"));var s=r&&-1!=navigator.userAgent.indexOf("Edg"),o=(r||e)&&!!window.CSS;return e?"opera":t?"firefox":i?"ie":n||s?"edge":r?"chrome":o?"blink":"unknown"}function ne(e,t,i,s){var o=s.matchAccount()||{},a=s.matchSession()||{};if(!function(e,t,i){if(!t)return!0;if(n.get(e,"once_per_user"))return!1;var r=i.matchSession()||{};return!(n.get(e,"once_per_session")&&t.session_id===r.id||n.get(e,"interval_sec")&&n.get(e,"interval_sec")>(c.now()-t.created)/1e3)}(e,i,s))return!1;for(var u=0;u<A(t);u++){var l=t[u];switch(l.key){case"url":let e=b(l.exclude_urls,(e=>B(e)));if(A(e)>0&&E(e,(e=>B(window.location.href).indexOf(B(e))>-1)))return!1;let t=b(l.urls,(e=>B(e)));if(A(t)>0&&!E(t,(e=>B(window.location.href).indexOf(B(e))>-1)))return!1;break;case"browser":if(A(l.browsers)>0){var h=ie();if(!E(l.browsers,(e=>B(e)===B(h))))return!1}break;case"location":if(A(l.exclude_locations)>0&&E(l.exclude_locations,(e=>!(!e.city_name||!e.country_code||e.city_name!==a.city_name||e.country_code!==a.country_code)||!(!e.city_name||e.country_code||e.city_name!==a.city_name)||!(e.city_name||!e.country_code||e.country_code!==a.country_code)||void 0)))return!1;if(A(l.locations)>0&&!E(l.locations,(e=>!(!e.city_name||!e.country_code||e.city_name!==a.city_name||e.country_code!==a.country_code)||!(!e.city_name||e.country_code||e.city_name!==a.city_name)||!(e.city_name||!e.country_code||e.country_code!==a.country_code)||void 0)))return!1;break;case"returning_visitor":if(l.returning_visitor&&s.new_visitor)return!1;if(!l.returning_visitor&&!s.new_visitor)return!1;break;case"user_is_a_contact":let i=n.get(s.matchUser(),"attributes",[]),f=E(i,(e=>"emails"===e.key)),g=E(i,(e=>"phones"===e.key)),_=f||g;if(l.user_is_a_contact&&!_)return!1;if(!l.user_is_a_contact&&_)return!1;break;case"device_type":if(A(l.device_types)>0){let e="desktop";if(s.isMobile()&&(e="mobile"),s.isTablet()&&(e="tablet"),!E(l.device_types,(t=>B(t)===B(e))))return!1}break;case"referer":if(A(l.exclude_referers)>0&&E(l.exclude_referers,(e=>B(document.referrer).indexOf(B(e))>-1)))return!1;if(A(l.urls)>0&&!E(l.referers,(e=>B(document.referrer).indexOf(B(e))>-1)))return!1;break;case"source":if(A(l.sources)>0&&!E(l.sources,(e=>B(e)===B(a.source))))return!1;break;case"user_attribute":let m,v=n.get(s.matchUser(),"attributes",[]),y=n.get(l,"user.operator");x(v,(e=>{e&&e.key===n.get(l,"user.key")&&(m=e.datetime||e.boolean||e.number||e.text||e.list)}));let w=!0;switch(y){case"cons":let e=r(l.value)||[];if(0===A(e))return!1;w=!!E(e,(e=>B(m).indexOf(B(e))>-1));break;case"notEmpty":w=!!m;break;case"empty":w=!m;break;case"true":w=!0===m||"true"===m;break;case"false":w=!m||!1===m||"false"===m}if(!w)return!1;break;case"timming":if("in"===l.business_hour&&!o.is_in_business_hour)return!1;if("notIn"===l.business_hour&&o.is_in_business_hour)return!1;if(A(l.days_of_week)>0&&!E(l.days_of_week,(e=>B(se((new c).getDay()))===B(e))))return!1;if(A(l.minute_of_days)>0&&A(l.minute_of_days)%2==0){var d=new c,p=d.getMinutes()+60*d.getHours();let e=!1;for(u=0;u<l.minute_of_days.length;u+=2)if(l.minute_of_days[u]<=p&&p<=l.minute_of_days[u+1]){e=!0;break}if(!e)return!1}break;case"offline":if(!o.is_online!=!!l.offline)return!1}}return!0}function se(e){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]}let oe={};function ae(e){for(var t=0;t<e.length;t++){let n=e[t];if(n&&!oe[n]){oe[n]=!0;for(var i=0;i<2;i++){let e=[400,500][i],t=document.createElement("div");t.innerHTML="@!-/#Chào mỪng1",t.style.position="absolute",t.style.display="block",t.style.fontSize="1px",t.style.height="0px",t.style.width="0px",t.style.fontWeight=e,t.setAttribute("subiz-preload",n+":"+e),document.body.appendChild(t),t.style.fontFamily=n,l((()=>t.remove()),3e3)}}}}function ce(e,t){if(t||(t=()=>{}),!e)return t(),Promise.resolve(!0);let i=new Image;return e=function(e){let t="https://vcdn.subiz-cdn.com/file/";return e?S(e,"/")||S(e,"data:")?e:(S(e,"http://")||S(e,"https://")||S(e,"//")||(e=j(t)+"/"+P(e,"/")),(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("https://file-subiz.com/",t)).replace("http://file-subiz.com/",t)).replace("https://file-v4.subiz.com/",t)).replace("http://file-v4.subiz.com/",t)).replace("https://filev4.subiz.com/",t)).replace("http://filev4.subiz.com/",t)).replace("https://filev4-1.subiz.com/",t)).replace("http://filev4-1.subiz.com/",t)).replace("https://file.subiz.com/",t)).replace("http://file.subiz.com/",t)).replace("https://file.mysubiz.com/",t)).replace("http://file.mysubiz.com/",t)):""}(e),i.src=e,new Promise((e=>{i.onload=()=>{t(),e()}}))}function ue(e){if(!e)return 0;e.length<=2&&(e+=":00");let t=e.split(":");if(2!==t.length)return 0;let i=parseInt(t[0]);if(i<0||i>23)return 0;let n=parseInt(t[1]);return n<0||n>59?0:60*i+n}function le(e,t,i){var n=-(new c).getTimezoneOffset();i&&(n=ue(i));var r=new c(e).getTime(),s=new c(t).getTime(),o=Math.ceil((r/60/1e3+n)/60/24),a=Math.ceil((s/60/1e3+n)/60/24);return Math.abs(o-a)}function he(e,t,i){var n=-(new c).getTimezoneOffset(),r=-(new c).getTimezoneOffset();i&&(r=ue(i));var s=new c(e).getTime()+60*(r-n)*1e3,o=new c(t).getTime()+60*(r-n)*1e3;return Math.abs(new c(s).getYear()-new c(o).getYear())}function de(e,t,i){return 0===le(e,t,i)}function pe(e,t,i){var r=-(new c).getTimezoneOffset(),s=r;t&&(s=ue(t));var o=new c(ge(e));let a=new c(o);a.setMinutes(o.getMinutes()+s-r),i||(i=new c);let u=a.getHours(),l=a.getMinutes(),h=n.get(navigator,"languages.0","en-US"),d=a.toLocaleDateString(h,{weekday:"long"}),p=a.getFullYear(),f=a.getMonth()+1,g=a.toLocaleDateString(h,{month:"long"}),_=a.getDate();return u<10&&(u="0"+u),l<10&&(l="0"+l),de(o,i,t)?u+":"+l:le(o,i,t)<=5?d+", "+u+":"+l:0===he(o,i,t)?g+" "+_+", "+u+":"+l:p+"/"+f+"/"+_+", "+u+":"+l}function fe(e){return Math.floor(ge(e)/1e3)}function ge(e){return e?"number"!=typeof e&&(e=new c(e).getTime()):e=0,e>1e18?Math.floor(e/1e6):e>1e15?Math.floor(e/1e3):e>1e12?e:1e3*e}function _e(){let e=me(),t=document.getElementsByTagName("html")[0].getAttribute("xml:lang")||document.getElementsByTagName("html")[0].getAttribute("lang"),i=navigator.language;return e||t||i}function me(){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+name+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}var ve=e=>new Promise((t=>l(t,e)))},2302:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});class n{constructor(e){this.isOpen=!0===e,this.cbs=[]}open(){this.isOpen=!0;let e=[];this.cbs.forEach((t=>{this.isOpen?t():e.push(t)})),this.cbs=e}close(){this.isOpen=!1}entry(e,t){return this.isOpen?(t&&(this.isOpen=!1),e&&e(),Promise.resolve()):new Promise((i=>{this.cbs.push((()=>{t&&(this.isOpen=!1),e&&e(),i()}))}))}}},819:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Z});var n={};i.r(n),i.d(n,{extract:()=>d,extractEmails:()=>l,extractEmojis:()=>c,extractLinks:()=>u,extractPhones:()=>h,extractText:()=>f,pipeExtracts:()=>p});var r={};i.r(r),i.d(r,{trackAreaClicked:()=>v,trackExitIntent:()=>_,trackInactivity:()=>y,trackScrollingPercentage:()=>m,trackTimeOnPage:()=>w});var s=i(8733),o=i(8733);let a=["like","unlike","wink","tongue-out","tired","surprised","smiling","sleepy","sad","neutral","heart-eyes","grinning","crying","confused","angry","cry","heart_eyes","neutral_face","emoji--disappointed","smile","open_mouth","tired_face","stuck_out_tongue","moyai","thumbsdown","dislike","thumbsup","ok_hand","octopus","pig2","wave","mouse","mouse2","rat"];function c(e){for(var t=[],i=0;i<e.length;i++)for(var n=0;n<a.length;n++)if(e.indexOf(a[n],i)===i){t.push({index:i,length:a[n].length}),i+=a[n].length-1;break}return t}function u(e){e=e||"";for(var t,i=/(https?:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.,~#?&//=]*)/gim,n=[];t=i.exec(e);)n.push({index:t.index,length:i.lastIndex-t.index});return n}function l(e){e=e||"";for(var t,i=/(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/gim,n=[];t=i.exec(e);)n.push({index:t.index,length:i.lastIndex-t.index});return n}function h(e){e=e||"";for(var t="",i={},n=0;n<e.length;n++){var r=e.charAt(n);if("."===r||"-"===r||" "===r){var s=n>0?e.charAt(n-1):"-",o=n<e.length-1?e.charAt(n+1):"-";-1!=="0123456789".indexOf(s)&&-1!=="0123456789".indexOf(o)||(i[(t+=r).length-1]=n)}else i[(t+=r).length-1]=n}for(var a,c=/([0-9]{8,13})/gim,u=[];a=c.exec(t);)u.push({index:i[a.index],length:i[c.lastIndex-1]-i[a.index]+1});return u}function d(e,t,i){if(!e)return[];var n=[],r=0,s=t(e);if(0===o.size(s))return[{type:"text",text:e}];o.each(s,(t=>{n.push({type:"text",text:e.substr(r,t.index-r)}),n.push({type:i,text:e.substr(t.index,t.length)}),r=t.index+t.length}));var a=o.last(s);return n.push({type:"text",text:e.substr(a.index+a.length,e.length-a.index+a.length)}),o.filter(n,(e=>""!==e.text))}function p(e,t){var i=[];if(0===o.size(t))return[{type:"text",text:e}];var n=t.shift(),r=d(e,n,n.type);return o.each(r,(e=>{if("text"!==e.type)return i.push(e);i=i.concat(p(e.text,t.slice()))})),i}function f(e){var t=u;t.type="link";var i=l;i.type="email";var n=h;n.type="phone";var r=c;return r.type="emoji",p(e,[i,t,n,r])}a=o.map(a,(e=>":"+e+":"));var g=i(8733);function _(e){let t=i=>{i.clientY>10||(e&&e(),document.removeEventListener("mouseout",t))};document.addEventListener("mouseout",t)}function m(e,t){let i=n=>{let r=n.srcElement.scrollingElement?n.srcElement.scrollingElement.scrollTop:n.srcElement.scrollTop,s=n.srcElement.scrollingElement?n.srcElement.scrollingElement.scrollHeight:n.srcElement.scrollHeight;r>0&&s>0&&r/s>=e&&(t&&t(),window.removeEventListener("scroll",i,!1))};window.addEventListener("scroll",i,!1)}function v(e,t){e&&(e=e||"",g.map(e.split("\n"),(e=>{if(!(e=g.trim(e)))return;let i=document.querySelectorAll(e);g.map(i,(e=>{e&&e.addEventListener("click",t,!1)}))})))}function y(e,t){let i=["scroll","keyup","keydown","mousemove","mousewheel","mouseenter","mouseover","mousedown","touchstart","touchmove","touchenter"],n=0,r=()=>{n=0},s=setInterval((()=>{if(n++,!(n<e)){t&&t();for(let e of i)document.removeEventListener(e,r,!1);clearInterval(s)}}),1e3);for(let e of i)document.addEventListener(e,r,!1)}let b=0;function w(e,t){if(e<1)return setTimeout((function(){t(e)}),100);let i=setInterval((()=>{b<e||(t&&t(b),clearInterval(i))}),1e3)}setInterval((()=>b++),1e3);var k={};(k=Object.assign(k,s)).Gate=i(2302).Z;var x=i(6877);k.get=x.get,k.set=x.set,k.Pubsub=i(2851).Z,k=Object.assign(k,n);const Z=k=Object.assign(k,r)},6877:(e,t,i)=>{"use strict";i.r(t),i.d(t,{get:()=>a,set:()=>c});var n=Object.prototype.toString,r=Array.isArray||function(e){return"[object Array]"===n.call(e)};function s(e){var t=parseInt(e);return t.toString()===e?t:e}function o(e,t){if(function(e,t){return"number"==typeof t&&r(e)||function(e,t){return null!=e&&Object.prototype.hasOwnProperty.call(e,t)}(e,t)}(e,t))return e[t]}function a(e,t,i){if("number"==typeof t&&(t=[t]),!t||0===t.length)return e;if(null==e)return i;if("string"==typeof t)return a(e,t.split("."),i);var n=s(t[0]),r=o(e,n);return void 0===r?i:1===t.length?r:a(e[n],t.slice(1),i)}function c(e,t,i){if("number"==typeof t&&(t=[t]),!t||0===t.length)return e;if("string"==typeof t)return c(e,t.split(".").map(s),i);var n=t[0],r=o(e,n);return 1===t.length?(e[n]=i,r):(void 0===r&&(e[n]="number"==typeof t[1]?[]:{}),c(e[n],t.slice(1),i))}},2851:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var{filter:n,map:r}=i(8733);class s{constructor(){this.listeners={}}publish(e,t,i,s){this.listeners[e]=n(this.listeners[e],(e=>e.obj._isMounted)),r(this.listeners[e],(e=>{let{cb:n}=e;return n(t,i,s)}))}on2(e,t,i){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push({obj:e,cb:i})}}},9554:function(e){e.exports=function(){"use strict";var e=function(){return e.get.apply(e,arguments)},t=e.utils={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isPlainObject:function(e){return!!e&&"[object Object]"===Object.prototype.toString.call(e)},toArray:function(e){return Array.prototype.slice.call(e)},getKeys:Object.keys||function(e){var t=[],i="";for(i in e)e.hasOwnProperty(i)&&t.push(i);return t},encode:function(e){return String(e).replace(/[,;"\\=\s%]/g,(function(e){return encodeURIComponent(e)}))},decode:function(e){return decodeURIComponent(e)},retrieve:function(e,t){return null==e?t:e}};return e.defaults={},e.expiresMultiplier=86400,e.set=function(e,i,n){if(t.isPlainObject(e))for(var r in e)e.hasOwnProperty(r)&&this.set(r,e[r],i);else{var s=void 0!==(n=t.isPlainObject(n)?n:{expires:n}).expires?n.expires:this.defaults.expires||"",o=typeof s;"string"===o&&""!==s?s=new Date(s):"number"===o&&(s=new Date(+new Date+1e3*this.expiresMultiplier*s)),""!==s&&"toUTCString"in s&&(s=";expires="+s.toUTCString());var a=n.path||this.defaults.path;a=a?";path="+a:"";var c=n.domain||this.defaults.domain;c=c?";domain="+c:"";var u=n.secure||this.defaults.secure?";secure":"";!1===n.secure&&(u="");var l=n.sameSite||this.defaults.sameSite;l=l?";SameSite="+l:"",null===n.sameSite&&(l=""),document.cookie=t.encode(e)+"="+t.encode(i)+s+a+c+u+l}return this},e.setDefault=function(i,n,r){if(t.isPlainObject(i)){for(var s in i)void 0===this.get(s)&&this.set(s,i[s],n);return e}if(void 0===this.get(i))return this.set.apply(this,arguments)},e.remove=function(e){for(var i=0,n=(e=t.isArray(e)?e:t.toArray(arguments)).length;i<n;i++)this.set(e[i],"",-1);return this},e.removeSpecific=function(e,i){if(!i)return this.remove(e);e=t.isArray(e)?e:[e],i.expires=-1;for(var n=0,r=e.length;n<r;n++)this.set(e[n],"",i);return this},e.empty=function(){return this.remove(t.getKeys(this.all()))},e.get=function(e,i){var n=this.all();if(t.isArray(e)){for(var r={},s=0,o=e.length;s<o;s++){var a=e[s];r[a]=t.retrieve(n[a],i)}return r}return t.retrieve(n[e],i)},e.all=function(){if(""===document.cookie)return{};for(var e=document.cookie.split("; "),i={},n=0,r=e.length;n<r;n++){var s=e[n].split("="),o=t.decode(s.shift()),a=t.decode(s.join("="));i[o]=a}return i},e.enabled=function(){if(navigator.cookieEnabled)return!0;var t="_"===e.set("_","_").get("_");return e.remove("_"),t},e}()},6400:(e,t,i)=>{"use strict";i.d(t,{sY:()=>U,h:()=>f,HY:()=>m,Vf:()=>_,wA:()=>v});var n,r,s,o,a,c,u={},l=[],h=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function d(e,t){for(var i in t)e[i]=t[i];return e}function p(e){var t=e.parentNode;t&&t.removeChild(e)}function f(e,t,i){var r,s,o,a={};for(o in t)"key"==o?r=t[o]:"ref"==o?s=t[o]:a[o]=t[o];if(arguments.length>2&&(a.children=arguments.length>3?n.call(arguments,2):i),"function"==typeof e&&null!=e.defaultProps)for(o in e.defaultProps)void 0===a[o]&&(a[o]=e.defaultProps[o]);return g(e,a,r,s,null)}function g(e,t,i,n,o){var a={type:e,props:t,key:i,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==o?++s:o};return null==o&&null!=r.vnode&&r.vnode(a),a}function _(){return{current:null}}function m(e){return e.children}function v(e,t){this.props=e,this.context=t}function y(e,t){if(null==t)return e.__?y(e.__,e.__.__k.indexOf(e)+1):null;for(var i;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e)return i.__e;return"function"==typeof e.type?y(e):null}function b(e){var t,i;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e){e.__e=e.__c.base=i.__e;break}return b(e)}}function w(e){(!e.__d&&(e.__d=!0)&&o.push(e)&&!k.__r++||c!==r.debounceRendering)&&((c=r.debounceRendering)||a)(k)}function k(){for(var e;k.__r=o.length;)e=o.sort((function(e,t){return e.__v.__b-t.__v.__b})),o=[],e.some((function(e){var t,i,n,r,s,o;e.__d&&(s=(r=(t=e).__v).__e,(o=t.__P)&&(i=[],(n=d({},r)).__v=r.__v+1,j(o,r,n,t.__n,void 0!==o.ownerSVGElement,null!=r.__h?[s]:null,i,null==s?y(r):s,r.__h),P(i,r),r.__e!=s&&b(r)))}))}function x(e,t,i,n,r,s,o,a,c,h){var d,p,f,_,v,b,w,k=n&&n.__k||l,x=k.length;for(i.__k=[],d=0;d<t.length;d++)if(null!=(_=i.__k[d]=null==(_=t[d])||"boolean"==typeof _?null:"string"==typeof _||"number"==typeof _||"bigint"==typeof _?g(null,_,null,null,_):Array.isArray(_)?g(m,{children:_},null,null,null):_.__b>0?g(_.type,_.props,_.key,null,_.__v):_)){if(_.__=i,_.__b=i.__b+1,null===(f=k[d])||f&&_.key==f.key&&_.type===f.type)k[d]=void 0;else for(p=0;p<x;p++){if((f=k[p])&&_.key==f.key&&_.type===f.type){k[p]=void 0;break}f=null}j(e,_,f=f||u,r,s,o,a,c,h),v=_.__e,(p=_.ref)&&f.ref!=p&&(w||(w=[]),f.ref&&w.push(f.ref,null,_),w.push(p,_.__c||v,_)),null!=v?(null==b&&(b=v),"function"==typeof _.type&&_.__k===f.__k?_.__d=c=Z(_,c,e):c=C(e,_,f,k,v,c),"function"==typeof i.type&&(i.__d=c)):c&&f.__e==c&&c.parentNode!=e&&(c=y(f))}for(i.__e=b,d=x;d--;)null!=k[d]&&("function"==typeof i.type&&null!=k[d].__e&&k[d].__e==i.__d&&(i.__d=y(n,d+1)),T(k[d],k[d]));if(w)for(d=0;d<w.length;d++)E(w[d],w[++d],w[++d])}function Z(e,t,i){for(var n,r=e.__k,s=0;r&&s<r.length;s++)(n=r[s])&&(n.__=e,t="function"==typeof n.type?Z(n,t,i):C(i,n,n,r,n.__e,t));return t}function C(e,t,i,n,r,s){var o,a,c;if(void 0!==t.__d)o=t.__d,t.__d=void 0;else if(null==i||r!=s||null==r.parentNode)e:if(null==s||s.parentNode!==e)e.appendChild(r),o=null;else{for(a=s,c=0;(a=a.nextSibling)&&c<n.length;c+=2)if(a==r)break e;e.insertBefore(r,s),o=s}return void 0!==o?o:r.nextSibling}function z(e,t,i){"-"===t[0]?e.setProperty(t,i):e[t]=null==i?"":"number"!=typeof i||h.test(t)?i:i+"px"}function S(e,t,i,n,r){var s;e:if("style"===t)if("string"==typeof i)e.style.cssText=i;else{if("string"==typeof n&&(e.style.cssText=n=""),n)for(t in n)i&&t in i||z(e.style,t,"");if(i)for(t in i)n&&i[t]===n[t]||z(e.style,t,i[t])}else if("o"===t[0]&&"n"===t[1])s=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=i,i?n||e.addEventListener(t,s?O:A,s):e.removeEventListener(t,s?O:A,s);else if("dangerouslySetInnerHTML"!==t){if(r)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==i?"":i;break e}catch(e){}"function"==typeof i||(null!=i&&(!1!==i||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,i):e.removeAttribute(t))}}function A(e){this.l[e.type+!1](r.event?r.event(e):e)}function O(e){this.l[e.type+!0](r.event?r.event(e):e)}function j(e,t,i,n,s,o,a,c,u){var l,h,p,f,g,_,y,b,w,k,Z,C=t.type;if(void 0!==t.constructor)return null;null!=i.__h&&(u=i.__h,c=t.__e=i.__e,t.__h=null,o=[c]),(l=r.__b)&&l(t);try{e:if("function"==typeof C){if(b=t.props,w=(l=C.contextType)&&n[l.__c],k=l?w?w.props.value:l.__:n,i.__c?y=(h=t.__c=i.__c).__=h.__E:("prototype"in C&&C.prototype.render?t.__c=h=new C(b,k):(t.__c=h=new v(b,k),h.constructor=C,h.render=L),w&&w.sub(h),h.props=b,h.state||(h.state={}),h.context=k,h.__n=n,p=h.__d=!0,h.__h=[]),null==h.__s&&(h.__s=h.state),null!=C.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=d({},h.__s)),d(h.__s,C.getDerivedStateFromProps(b,h.__s))),f=h.props,g=h.state,p)null==C.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==C.getDerivedStateFromProps&&b!==f&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(b,k),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(b,h.__s,k)||t.__v===i.__v){h.props=b,h.state=h.__s,t.__v!==i.__v&&(h.__d=!1),h.__v=t,t.__e=i.__e,t.__k=i.__k,t.__k.forEach((function(e){e&&(e.__=t)})),h.__h.length&&a.push(h);break e}null!=h.componentWillUpdate&&h.componentWillUpdate(b,h.__s,k),null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(f,g,_)}))}h.context=k,h.props=b,h.state=h.__s,(l=r.__r)&&l(t),h.__d=!1,h.__v=t,h.__P=e,l=h.render(h.props,h.state,h.context),h.state=h.__s,null!=h.getChildContext&&(n=d(d({},n),h.getChildContext())),p||null==h.getSnapshotBeforeUpdate||(_=h.getSnapshotBeforeUpdate(f,g)),Z=null!=l&&l.type===m&&null==l.key?l.props.children:l,x(e,Array.isArray(Z)?Z:[Z],t,i,n,s,o,a,c,u),h.base=t.__e,t.__h=null,h.__h.length&&a.push(h),y&&(h.__E=h.__=null),h.__e=!1}else null==o&&t.__v===i.__v?(t.__k=i.__k,t.__e=i.__e):t.__e=M(i.__e,t,i,n,s,o,a,u);(l=r.diffed)&&l(t)}catch(e){t.__v=null,(u||null!=o)&&(t.__e=c,t.__h=!!u,o[o.indexOf(c)]=null),r.__e(e,t,i)}}function P(e,t){r.__c&&r.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){r.__e(e,t.__v)}}))}function M(e,t,i,r,s,o,a,c){var l,h,d,f=i.props,g=t.props,_=t.type,m=0;if("svg"===_&&(s=!0),null!=o)for(;m<o.length;m++)if((l=o[m])&&(l===e||(_?l.localName==_:3==l.nodeType))){e=l,o[m]=null;break}if(null==e){if(null===_)return document.createTextNode(g);e=s?document.createElementNS("http://www.w3.org/2000/svg",_):document.createElement(_,g.is&&g),o=null,c=!1}if(null===_)f===g||c&&e.data===g||(e.data=g);else{if(o=o&&n.call(e.childNodes),h=(f=i.props||u).dangerouslySetInnerHTML,d=g.dangerouslySetInnerHTML,!c){if(null!=o)for(f={},m=0;m<e.attributes.length;m++)f[e.attributes[m].name]=e.attributes[m].value;(d||h)&&(d&&(h&&d.__html==h.__html||d.__html===e.innerHTML)||(e.innerHTML=d&&d.__html||""))}if(function(e,t,i,n,r){var s;for(s in i)"children"===s||"key"===s||s in t||S(e,s,null,i[s],n);for(s in t)r&&"function"!=typeof t[s]||"children"===s||"key"===s||"value"===s||"checked"===s||i[s]===t[s]||S(e,s,t[s],i[s],n)}(e,g,f,s,c),d)t.__k=[];else if(m=t.props.children,x(e,Array.isArray(m)?m:[m],t,i,r,s&&"foreignObject"!==_,o,a,o?o[0]:i.__k&&y(i,0),c),null!=o)for(m=o.length;m--;)null!=o[m]&&p(o[m]);c||("value"in g&&void 0!==(m=g.value)&&(m!==e.value||"progress"===_&&!m)&&S(e,"value",m,f.value,!1),"checked"in g&&void 0!==(m=g.checked)&&m!==e.checked&&S(e,"checked",m,f.checked,!1))}return e}function E(e,t,i){try{"function"==typeof e?e(t):e.current=t}catch(e){r.__e(e,i)}}function T(e,t,i){var n,s;if(r.unmount&&r.unmount(e),(n=e.ref)&&(n.current&&n.current!==e.__e||E(n,null,t)),null!=(n=e.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){r.__e(e,t)}n.base=n.__P=null}if(n=e.__k)for(s=0;s<n.length;s++)n[s]&&T(n[s],t,"function"!=typeof e.type);i||null==e.__e||p(e.__e),e.__e=e.__d=void 0}function L(e,t,i){return this.constructor(e,i)}function U(e,t,i){var s,o,a;r.__&&r.__(e,t),o=(s="function"==typeof i)?null:i&&i.__k||t.__k,a=[],j(t,e=(!s&&i||t).__k=f(m,null,[e]),o||u,u,void 0!==t.ownerSVGElement,!s&&i?[i]:o?null:t.firstChild?n.call(t.childNodes):null,a,!s&&i?i:o?o.__e:t.firstChild,s),P(a,e)}n=l.slice,r={__e:function(e,t){for(var i,n,r;t=t.__;)if((i=t.__c)&&!i.__)try{if((n=i.constructor)&&null!=n.getDerivedStateFromError&&(i.setState(n.getDerivedStateFromError(e)),r=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(e),r=i.__d),r)return i.__E=i}catch(t){e=t}throw e}},s=0,v.prototype.setState=function(e,t){var i;i=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=d({},this.state),"function"==typeof e&&(e=e(d({},i),this.props)),e&&d(i,e),null!=e&&this.__v&&(t&&this.__h.push(t),w(this))},v.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),w(this))},v.prototype.render=m,o=[],a="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,k.__r=0}},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={id:e,exports:{}};return i[e].call(s.exports,s,s.exports,r),s.exports}r.m=i,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,i)=>(r.f[i](e,t),t)),[])),r.u=e=>"17d02a15859."+e+".js",r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="@subiz/widget-v4:",r.l=(i,n,s,o)=>{if(e[i])e[i].push(n);else{var a,c;if(void 0!==s)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var h=u[l];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+s){a=h;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",t+s),a.src=i),e[i]=[n];var d=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var r=e[i];if(delete e[i],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(n))),t)return t(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="https://vcdn.subiz-cdn.com/widget-v4/public/",(()=>{var e={143:0};r.f.j=(t,i)=>{var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var s=new Promise(((i,r)=>n=e[t]=[i,r]));i.push(n[2]=s);var o=r.p+r.u(t),a=new Error;r.l(o,(i=>{if(r.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,n[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var n,s,[o,a,c]=i,u=0;if(o.some((t=>0!==e[t]))){for(n in a)r.o(a,n)&&(r.m[n]=a[n]);c&&c(r)}for(t&&t(i);u<o.length;u++)s=o[u],r.o(e,s)&&e[s]&&e[s][0](),e[o[u]]=0},i=self.webpackChunk_subiz_widget_v4=self.webpackChunk_subiz_widget_v4||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e=r(819),t=r(1606).Z,i=r(4878).Z,n=r(9489).Z;const s={kv:t,lsdb:r(6929).Z,chain:i,inmem_localstorage:n};function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const a=r(7460);a.env.XMLHttpRequest=window.XMLHttpRequest;const c=e=>e.answer;function u(t,i){let n=t.request;"text/plain"===n.content_type&&void 0!==n.body&&(n.body=e.Z.stringify(n.body)),i(!0)}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const h=r(7460);function d(t,i){let n=t.request;"text/plain"===n.content_type&&void 0!==n.body&&(n.body=e.Z.stringify(n.body)),i(!0)}h.env.XMLHttpRequest=window.XMLHttpRequest;const p=Promise.resolve({code:200});function f(e,t,i,n){let r=e+".subizv4.subikon";return{id:t,account_id:e,created:1610452894916,members:[{type:"user",id:i,membership:"active",invited_by:{id:i,type:"user"}},{type:"agent",id:n,conversation_id:t,membership:"active",invited_by:{id:i,type:"user"}}],ended:1610454875505,state:"ended",integration:{account_id:e,connector_id:"subikon",name:"Subiz Widget",connector_type:"subiz",state:"activated",id:r},actived:1610453070259,last_event:{id:"evqyiykaoizbwnkaecwphttwk",account_id:e,created:1616213311830,type:"message_sent",by:{id:i,client_id:"clsubizapi",type:"user"},data:{message:{conversation_id:t,text:"ok cám ơn!",format:"plaintext",integration_id:r,pongs:[{member_id:i,type:"seen",created:1616213312110}]}}},last_message_sent:{id:"evqyiykaoizbwnkaecwphttwk",account_id:e,created:1616213311830,type:"message_sent",by:{id:i,client_id:"clsubizapi",type:"user"},data:{message:{conversation_id:t,text:"ok cám ơn!",format:"plaintext",integration_id:r,pongs:[{member_id:i,type:"seen",created:1616213312110}]}}},assigned_to:{},first_message:"Xin chào",subject:"Chúc một ngày tốt lành",source:"https://subiz.com.vn/"}}function g(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var _=r(3165),m=r(8454),v=r(9554);v.defaults.path="/",v.expiresMultiplier=86400,v.defaults.expires=3650;const y=e.Z.Date.now();class b{constructor(t,i,n,r,_,m){g(this,"inmem",!1),g(this,"cookie",v),g(this,"new_visitor",!0),g(this,"matchUser",(()=>(this._touchAcc(),this.kv.match("user")))),g(this,"matchSession",(()=>this.kv.match("session")||{})),g(this,"matchAccount",(()=>this.cache.match("account"))),g(this,"matchUnread",(()=>{let t=this.matchUser(),i=this.matchConvo("*"),n=0;return e.Z.map(i,(i=>{e.Z.isConvoSeen(i,t.id)||n++})),n})),g(this,"matchPlugin",(()=>e.Z.size(this.forcePlugins)>0?e.Z.cloneDeep(this.forcePlugins):e.Z.cloneDeep(this.cache.match("plugin"))||{})),g(this,"device",{}),g(this,"browserVisibility","visible"),g(this,"matchAgent",(e=>{let t=this.cache.match("agent")||{};return"*"===e?t:t[e]})),g(this,"matchConvo",(t=>{if(t)return"*"===t?(this._touchAcc(),e.Z.filter(this.cache.all(),((e,t)=>t.startsWith("convo_")))):(this.isInsync(t)||this.fetchConvo(t),this.cache.match("convo_"+t))})),g(this,"fetchConvo",(async e=>{if(await this.readyGate.entry(),await this.reconnectGate.entry(void 0,!0),this.isInsync(e))return this.reconnectGate.open();this.markSync(e);let{body:t,error:i}=await this.api.getConversation(e);return t&&!i&&this._setConvo(t),this.reconnectGate.open()})),g(this,"listEvents",(e=>{if(e&&"*"!==e&&"string"==typeof e)return this.isInsync("events"+e)||setTimeout((async()=>(await this.readyGate.entry(),await this.reconnectGate.entry(void 0,!0),this.isInsync("events"+e)||(this.markSync("events"+e),await this.chain.reload(e,((e,t,i)=>this.listmessageapi(e,t,i))),this.pubsub.publish("account")),this.reconnectGate.open())),10),this.chain.listM(e)})),g(this,"fetchMoreEvents",(async e=>{let{error:t}=await this.chain.fetchMore(e,50,((e,t,i)=>this.listmessageapi(e,t,i)));return this.pubsub.publish("account"),{error:t}})),g(this,"matchBot",(()=>this.cache.match("bot")||{})),g(this,"readyGate",new e.Z.Gate),g(this,"convoGate",new e.Z.Gate(!0)),g(this,"reconnectGate",new e.Z.Gate(!0)),g(this,"matchLastview",(()=>this.kv.match("lastview")||{})),g(this,"matchIsOpen",(()=>!!this.kv.match("isopen"))),g(this,"matchHasManuallyClosed",(()=>!!this.kv.match("hasManuallyClosed"))),g(this,"matchClosePreviewAt",(()=>this.kv.match("close_preview_at")||0)),g(this,"sendPresence",e.Z.throttle((async()=>{if(await this.readyGate.entry(),e.Z.get(this.kv.match("user"),"id")&&!e.Z.isUserBanned(this.kv.match("user")))return this.api.sendPresence(this.device,"visible"===this.browserVisibility&&document.hasFocus())}),1e3)),g(this,"now",(()=>e.Z.Date.now()+this.timeDiff)),g(this,"seenQueue",[]),g(this,"_typing",e.Z.throttle((e=>this.api.sendTyping(e)),3e3)),g(this,"onConvoEvent",((e,t)=>this.pubsub.on2(e,"events",t))),g(this,"seenConvo",(e=>{e&&"create"!==e&&this.seenQueue.push(e)})),g(this,"onUpdate",((e,t)=>this.pubsub.on2(e,"account",t))),g(this,"onResetCSS",((e,t)=>this.pubsub.on2(e,"resetCSS",t))),g(this,"onHighlight",((e,t)=>this.pubsub.on2(e,"highlight",t))),g(this,"setHasManuallyClosed",(()=>this.kv.put("hasManuallyClosed",!0))),g(this,"setIsOpen",(e=>{let t=this.kv.match("isopen");this.kv.put("isopen",e),!t&&e&&Z("SUBIZ Chat","Opened","Subiz Windows")})),g(this,"closePreview",(()=>this.kv.put("close_preview_at",(new e.Z.Date).getTime()))),g(this,"setLastview",((e,t)=>this.kv.put("lastview",{view:e,opts:t}))),g(this,"timeDiff",0),this.agent_token=m,this.g_sync={},this.forceDevice=null,this.forcePlugins={},this.forceAcc={},this.forceChatbox={},this.RealtimeURL=n,this.fake=_,this.FileURL=i,this.fake?this.api=new class{constructor(t,i){l(this,"listConversations",(e=>{let t=f(this.accid,"csqwudlkftltnbebvq",this.uid,this.agentid);return Promise.resolve({body:{anchor:"",conversations:[t]},code:200})})),l(this,"listMessages",((e,t,i)=>{let n=function(e,t,i,n){let r=e+".subizv4.subikon";return[{id:"evqyiyjmxrjsylftvnrghrfmq",account_id:e,created:1616213202264,type:"conversation_invited",by:{id:i,type:"user"},data:{conversation:{id:t,account_id:e,members:[{type:"user",id:i,last_page_view_url:"https://subiz.com.vn/",membership:"observer",invited_by:{id:i,type:"user"}}],state:"pending"}}},{id:"evqyiyjmyqdgrouswczzawuzp",account_id:e,created:1616213202559,type:"conversation_invited",by:{id:i,type:"user"},data:{conversation:{id:t,account_id:e,members:[{type:"agent",id:n,conversation_id:t,membership:"observer",invited_by:{id:i,type:"user"}}],state:"pending",source:"https://subiz.com.vn/vi/"}}},{id:"evqyiyjmyzjpyehnngvmcyauf",account_id:e,created:1616213202668,type:"conversation_state_updated",by:{id:i,type:"user"},data:{conversation:{id:t,account_id:e,state:"active"}}},{id:"evqyiyjmzaozvqgbkljbwywdl",account_id:e,created:1616213202683,type:"conversation_joined",by:{id:i,type:"user"},data:{conversation:{id:t,members:[{type:"user",id:i,last_page_view_url:"https://subiz.com.vn/",membership:"active",invited_by:{id:i,type:"user"}}]}}},{id:"evqyiyjmzatvtgpdmmpzwnwgn",account_id:e,created:1616213202685,type:"message_sent",by:{id:i,client_id:"clsubizapi",type:"user"},data:{message:{conversation_id:t,text:"Xin chào",format:"plaintext",fields:[{key:"idempotency",value:'"wrueysyjbhqrkiwhsejpqrwqrdkkyaibajdw"'}],integration_id:r,pongs:[{member_id:i,type:"seen",created:1616213203068}]}}},{id:"evqyiyjrhsfyuxtetszmvkkke",account_id:e,created:1616213237491,type:"conversation_joined",by:{id:i,type:"user"},data:{conversation:{id:t,members:[{type:"agent",id:n,conversation_id:t,membership:"active",invited_by:{id:i,type:"user"}}]}}},{id:"evqyiyjrhtroknjyakrlrwhgr",account_id:e,created:1616213237508,type:"message_sent",by:{id:n,client_id:"dashboard",type:"agent"},data:{message:{conversation_id:t,text:"chào bạn, mình có thể giúp gì được cho bạn :grinning:",format:"plaintext",integration_id:r,pongs:[{member_id:i,type:"receive",created:1616213237742},{member_id:i,type:"seen",created:1616213240057}]}}},{id:"evqyiyjuvjinmclneroerxmrl",account_id:e,created:1616213265805,type:"message_sent",by:{id:i,client_id:"clsubizapi",type:"user"},data:{message:{conversation_id:t,text:"mình muốn hỏi giá sản phẩm IPhone X",format:"plaintext",integration_id:r,pongs:[{member_id:i,type:"seen",created:1616213267090}]}}},{id:"evqyiyjzjxzfcsexshcjbbnnf",account_id:e,created:1616213302432,type:"message_sent",by:{id:n,client_id:"dashboard",type:"agent"},data:{message:{conversation_id:t,text:"IPhone X hiện đang được bán tại cửa hàng với giá 12tr đồng nha bạn",format:"plaintext",integration_id:r,pongs:[{member_id:i,type:"receive",created:1616213302698},{member_id:i,type:"seen",created:1616213305071}]}}},{id:"evqyiykaoizbwnkaecwphttwk",account_id:e,created:1616213311830,type:"message_sent",by:{id:i,client_id:"clsubizapi",type:"user"},data:{message:{conversation_id:t,text:"ok cám ơn!",format:"plaintext",integration_id:r,pongs:[{member_id:i,type:"seen",created:1616213312110}]}}}]}(this.accid,"csqwudlkftltnbebvq",this.uid,this.agentid);return Promise.resolve({body:n,code:200})})),l(this,"ajax",h),l(this,"start",(e=>p)),l(this,"sendConvoEvent",((e,t)=>p)),l(this,"createPostback",((e,t)=>p)),l(this,"markAsReceived",((e,t)=>p)),l(this,"markAsSeen",((e,t)=>p)),l(this,"getConversation",(e=>Promise.resolve({body:f(this.accid,"csqwudlkftltnbebvq",this.uid,this.agentid),code:200}))),l(this,"getLocaleContent",(e=>this.apireq.get(`/accounts/${this.accid}/locales/${e}`))),l(this,"sendEvent",(e=>p)),l(this,"sendTyping",(e=>p)),l(this,"sendPresence",(e=>p)),l(this,"sendContent",(e=>p)),l(this,"uploadToS3",(async e=>p)),l(this,"getChallenge",(e=>p)),l(this,"createUser",(e=>Promise.resolve({account_id:e,id:"usqzgtgfake",mask:"fakemask"}))),l(this,"createAgentUser",(e=>Promise.resolve("fakemask"))),l(this,"time",(t=>Promise.resolve({code:200,body:(new e.Z.Date).toISOString()}))),l(this,"updateUser",(e=>p)),l(this,"getUser",(e=>Promise.resolve({code:200,body:{id:"-"}}))),l(this,"getAccountSetting",(()=>this.apireq.get(`/accounts/${this.accid}/settings`))),l(this,"getIsOnline",(()=>this.apireq.get(`/accounts/${this.accid}/is_online`))),l(this,"sendImpression",(e=>p)),l(this,"sendConversion",(e=>p)),this.FileURL=i,this.apireq=h.setBaseUrl(t).setContentType("text/plain").beforeHook(d).setParser("json")}setAgentId(e){this.agentid=e}setAuth(e){this.accid=e.accid,this.mask=e.mask,this.uid=e.uid}}(t,i):this.api=new class{constructor(t,i){o(this,"listConversations",(e=>this.apireq.addQuery("user_id",this.uid).addQuery("integration_id",`${this.accid}.subizv4.subikon`).get("/conversations"))),o(this,"listMessages",((e,t,i)=>this.apireq.addQuery("limit",t).addQuery("start_id",i).get(`/conversations/${e}/messages`))),o(this,"ajax",a),o(this,"start",(t=>{let i={starter_id:this.uid,starter_type:"user",integration_id:`${this.accid}.subizv4.subikon`};return e.Z.each(t,((e,t)=>{i[t]=e})),this.apireq.post("/conversations",i)})),o(this,"sendConvoEvent",((e,t)=>this.apireq.post(`/accounts/${this.accid}/conversations/${e}/events`,t))),o(this,"createPostback",((e,t)=>this.apireq.post(`/accounts/${this.accid}/conversations/${e}/postbacks`,t))),o(this,"markAsReceived",((e,t)=>this.apireq.post(`/conversations/${e}/messages/${t}/receive`))),o(this,"markAsSeen",((e,t)=>this.apireq.post(`/conversations/${e}/messages/${t}/seen`))),o(this,"getConversation",(e=>this.apireq.get(`/conversations/${e}`))),o(this,"getLocaleContent",(e=>this.apireq.get(`/accounts/${this.accid}/locales/${e}`))),o(this,"sendEvent",(e=>this.apireq.post(`/users/${this.uid}/events`,e))),o(this,"sendTyping",(e=>this.apireq.post(`/conversations/${e}/typing`))),o(this,"uploadToS3",(async e=>{let{body:t,error:i}=await this.apireq.post(`/accounts/${this.accid}/files`,{account_id:this.accid,description:"upload\n user-client: web-widget",name:e.name.replace(/\s+/g,"_"),size:e.size,type:e.type});if(i)return{error:i};let n,r=e.type||"application/octet-stream";return({error:i}=await a.setContentType(r).put(t.signed_url,e)),i?{error:i}:(({body:n,error:i}=await this.apireq.post(`/accounts/${this.accid}/files/${t.id}`,{account_id:this.accid})),i?{error:i}:{url:this.FileURL+n.url})})),o(this,"getChallenge",(e=>this.apireq.post(`/accounts/${e}/scrypt-challenges`))),o(this,"time",(e=>this.apireq.get("/time"))),o(this,"updateUser",(e=>this.apireq.post(`/users/${this.uid}`,e))),o(this,"getUser",(e=>this.apireq.get(`/accounts/${this.accid}/users/${this.uid}`))),o(this,"getAccountSetting",(()=>this.apireq.get(`/accounts/${this.accid}/settings`))),o(this,"getIsOnline",(()=>this.apireq.get(`/accounts/${this.accid}/is_online`))),o(this,"sendImpression",(e=>this.apireq.post(`/accounts/${this.accid}/campaigns/${e.campaign_id}/impressions`,e))),o(this,"sendConversion",(e=>this.apireq.post(`/accounts/${this.accid}/campaigns/${e.campaign_id}/conversions`,e))),this.FileURL=i,this.ApiURL=t,this.apireq=a.setBaseUrl(t).withCredentials(!0).addQuery("v","6").setContentType("text/plain").beforeHook(u).setParser("json").beforeHook(((e,t)=>(this.mask&&(e.request=e.request.addQuery("x-user-mask",this.mask)),t(!0))))}setAgentId(e){this.agentid=e}setAuth(e){this.accid=e.accid,this.mask=e.mask,this.uid=e.uid}sendPresence(t,i){return this.sendEvent({by:{id:this.uid,device:t},type:"presence_updated",data:{presence:{pinged:e.Z.Date.now(),is_focused:i}}})}sendContent(e,t,i){return this.sendEvent({by:{id:this.uid,device:e},type:"content_viewed",data:{product:{url:t,title:i}}})}async createAgentUser(t){for(var i=0;i<10;i++){let{body:i,error:n}=await a.setBaseUrl(this.ApiURL).setContentType("text/plain").beforeHook(u).setParser("json").addQuery("x-access-token",t).post("/agent-users");if(n){await e.Z.sleep(1e3);continue}let r=i&&i.id||"";return r?i.account_id+"@"+r:""}}async createUser(t){for(var i=0;i<10;i++){const{body:i}=await this.getChallenge(t),n=c(i),r={challenge_id:i.id,answer:""+n};let{body:s,error:o}=await this.apireq.post(`/accounts/${t}/scrypt-challenges/users`,r);if(!o)return s;await e.Z.sleep(1e3)}}}(t,i),r&&(this.inmem=r,this.cookie=k),this.pubsub=new e.Z.Pubsub,this.kv=new s.kv(new s.lsdb("sbz2020",this.inmem),"kv"),this.cache=new s.kv(new s.lsdb("sbz2020",!0),"kv"),this.chain=new s.chain(new s.lsdb("cbz2020",!0),"ch"),this.getLocaleContent=this.api.getLocaleContent,this.g_haveSentSeenM={},window.addEventListener("blur",(()=>this.sendPresence())),window.addEventListener("focus",(()=>this.sendPresence())),setInterval((()=>this.sendPresence()),3e4),function(e){var t="hidden";function i(i){var n="visible",r="hidden",s={focus:n,focusin:n,pageshow:n,blur:r,focusout:r,pagehide:r};(i=i||window.event).type in s?e(s[i.type]):e(this[t]?"hidden":"visible")}t in document?document.addEventListener("visibilitychange",i):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",i):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",i):(t="msHidden")in document?document.addEventListener("msvisibilitychange",i):"onfocusin"in document?document.onfocusin=document.onfocusout=i:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=i,void 0!==document[t]&&i({type:document[t]?"blur":"focus"})}((e=>{this.browserVisibility=e,this.sendPresence()})),this.loopTime(),this.device=this.getDeviceInfo();const y=setInterval((()=>{let t=this.kv.match("user")||{};if(!t.id)return;var i=this.getDeviceInfo();if(!i.ga_tracking_ids||!i.ga_client_id)return;clearInterval(y),this.device=i;let n=i.ga_client_id;n!==e.Z.getUserAttr(t,"ga_client_id","text")&&this.setUser({attributes:[{type:"text",text:n,key:"ga_client_id"}]})}),2e3)}isInsync(t){return e.Z.Date.now()-(this.g_sync[t]||0)<3e5}async overrideAcc(t){this.forceAcc=e.Z.cloneDeep(t),await this.readyGate.entry(),this.disconnect("account"),this.reconnect()}async overrideChatbox(e){this.forceChatbox=e,await this.readyGate.entry(),this.disconnect("account"),await this.reconnect(),setTimeout(this.pubsub.publish("resetCSS"),10)}getDeviceInfo(){let e={user_agent:window.navigator.userAgent,screen_resolution:window.screen.width+"x"+window.screen.height,source_referrer:document.referrer,platform:window.navigator.platform,referrer:document.URL,type:this.isMobile()?"mobile":"desktop",language:navigator.language},t=(i="",x()?((window.ga.getAll()||[]).forEach((function(e){i=e.get("clientId")})),i):i);var i;t&&(e.ga_client_id=t);let n=(r=[],x()?((window.ga.getAll()||[]).forEach((function(e){var t=e.get("trackingId");t&&r.push(t)})),r):r);var r;return n.length>0&&(e.ga_tracking_ids=n),e}highlight(e,t){this.pubsub.publish("highlight",e,t)}overrideDeviceType(e){this.forceDevice=e,this.pubsub.publish("account")}isMobile(){return"mobile"===this.forceDevice||C}isTablet(){return"tablet"===this.forceDevice||S}isDesktop(){return"desktop"===this.forceDevice||!this.isMobile()&&!this.isTable()}disconnect(e){this.g_sync[e]=0}pageLoaded(){return y}overridePlugin(t){if(!Array.isArray(t))throw"plugins must be be an array";let i={};e.Z.map(t,(function(e){i[e.id]=e})),this.forcePlugins=i,this.pubsub.publish("account"),this.pubsub.publish("resetCSS")}markSync(t){this.g_sync[t]=e.Z.Date.now()}async _touchAcc(){this.isInsync("account")||(await this.readyGate.entry(),this.isInsync("account")||this.reconnect())}async init(e){this.readyGate.close(),e=(e||"").trim(),this.api.setAuth({accid:e}),this.g_sync={};let t="";try{t=this.cookie.get("__sbmask","")}catch(e){}let i=this.kv.match("mask");!t&&i&&(t=i),t&&i&&t!==i&&this.clearBrowserData(),this.agent_token&&(t=await this.api.createAgentUser(this.agent_token));var n="";if(t){let i=t.split("@");i[0]!=e?(t="",this.clearBrowserData()):n=i[1]}if(t)this.new_visitor=!1;else{let i=await this.api.createUser(e);this.new_visitor=!0,t=i.mask,n=i.id}this.cookie.set("__sbmask",t),this.kv.put("mask",t),this.realtime&&this.realtime.stop(),this.fake?this.realtime=new class{onEvent(){}onInterrupted(){}subscribe(){}stop(){}}:this.realtime=new m(this.RealtimeURL,{user_mask:t}),this.realtime.onEvent(this.onWs.bind(this)),this.realtime.onInterrupted((()=>this.reconnectWs(e,n))),this.api.setAuth({accid:e,uid:n,mask:t}),this.seenLoop(),await this.reconnect(),this.readyGate.open(),this.reconnectWs(e,n)}seenLoop(){this.seenQueue=[],clearInterval(this._seenInterval),this._seenInterval=setInterval((()=>{this.seenQueue=[...new Set(this.seenQueue)];let t=this.kv.match("user")||{};e.Z.map(this.seenQueue,(i=>{var n=this.listEvents(i);if(!n)return;if(0===e.Z.size(n))return;var r=(n=e.Z.filter(n,(e=>"message_sent"===e.type)))[e.Z.size(n)-1];if(!r)return;if(this.g_haveSentSeenM[r.id])return;if(r.id===e.Z.getMsgField(r,"idempotency"))return;this.api.markAsSeen(i,r.id);let s=this.cache.match("convo_"+i)||{};e.Z.find(s.members,(e=>e.id===t.id)).seen_at=Date.now(),this._setConvo(s),this.g_haveSentSeenM[r.id]=!0})),this.seenQueue=[]}),1e3)}async reconnectWs(e,t){return await this.realtime.subscribe([`conversation_state_updated.account.${e}.user.${t}`,`conversation_joined.account.${e}.user.${t}`,`conversation_typing.account.${e}.user.${t}`,`message_sent.account.${e}.user.${t}`,`conversation_pending.account.${e}.user.${t}`,`user_info_updated.account.${e}.user.${t}`,`message_pong.account.${e}.user.${t}`,`conversation_rating_requested.account.${e}.user.${t}`,`conversation_rated.account.${e}.user.${t}`]),await this.readyGate.entry(),this.disconnect("account"),this.reconnect()}async reconnect(){if(this._die)return;if(await this.reconnectGate.entry(void 0,!0),this.isInsync("account"))return this.reconnectGate.open();this.markSync("account");let t=await Promise.all([this.api.getUser(),this.api.getAccountSetting(),this.api.getIsOnline()]),i=e.Z.find(t,(e=>e.error));if(i)return console.error(i);let n=Object.assign(t[1].body,t[2].body);n.user=t[0].body,await this._setSetting(n);let r=await this.api.listConversations();i=r.error;let s=r.body;if(!i){let t=e.Z.get(s,"conversations",[]);e.Z.map(this.cache.all(),((t,i)=>{i.startsWith("convo_")&&this.now()-e.Z.getMs(e.Z.get(t,"actived"))>12096e5&&this.cache.del(i)})),e.Z.map(t,(e=>this._setConvo(e)))}return this.reconnectGate.open()}async setUser(e){if(e)return await this.readyGate.entry(),this._setUser(e),this.api.updateUser(e)}_setUser(t){let i=this.kv.match("user")||{};var n=i.account_id||t.account_id,r=i.id||t.id;e.Z.each(t.attributes,(t=>{t&&(i.attributes=e.Z.filter(i.attributes,(e=>!!e&&e.key!==t.key)))})),i.attributes=i.attributes||[],i.attributes=i.attributes.concat(t.attributes),i.account_id=n,i.id=r,this.kv.put("user",i),this.pubsub.publish("account")}async setSetting(e){if(e)return await this.readyGate.entry(),this._setSetting(e)}async _setSetting(t){if((t=e.Z.cloneDeep(t)||{}).account=Object.assign({},t.account,this.forceAcc),t.account.logo_url||(t.account.logo_url="https://file-subiz.com/fiqpezhkmeyesdscyetk-default_logo.jpg"),t.user){t.user.account_id=t.account.id;let e=this.matchSession(),i=t.user.session;for(i?i.id===e.id&&(i._urls=e._urls):i=e,i._urls=i._urls||[],i._urls.push(location.href);i._urls.length>1e3;)i._urls.shift();this.kv.put("session",i),delete t.user.session,this._setUser(t.user)}t.account&&(t.account.is_online=t.is_online,t.account.is_in_business_hour=t.is_in_business_hour,this.cache.put("account",t.account),delete t.account);let i=e.Z.get(t,"bots",[]),n={};e.Z.map(i,(e=>{n[e.id]=e})),this.cache.put("bot",n);let r=e.Z.get(t,"plugins",[]),s={};e.Z.map(r,(t=>{"chatbox"===t.type&&(t=e.Z.merge(t,this.forceChatbox)),s[t.id]=t})),this.cache.put("plugin",s);var o=e.Z.get(t,"agents",[]);if(e.Z.size(o)>0){let t={};this.api.setAgentId(o[0].id),e.Z.map(o,(e=>{t[e.id]=e})),this.cache.put("agent",t)}this.pubsub.publish("account")}async track(){this.kv.match("user"),await this.api.sendContent(this.device,location.href,document.title),this.sendPresence()}async onWs(t){if(!t||!t.type)return;if(t.created=e.Z.getMs(t.created),"user_info_updated"===t.type){let i=e.Z.cloneDeep(this.kv.match("user")),n=e.Z.get(t,"data.user.attributes")||[];return e.Z.map(n,(t=>e.Z.setUserAttr(i,t))),void this._setUser(i)}let i=this.kv.match("user")||{};const n=e.Z.getIntegrationId(i.account_id);let r,s=e.Z.convoOfEv(t);if(s&&(r=this.matchConvo(s),!r||!r.id)){let{body:e,error:t}=await this.api.getConversation(s);if(!e)return;r=e}if(!r)return;let o=e.Z.get(r,"integration.id","");if(o||(o=e.Z.get(t,"data.message.integration_id","")),o&&o===n){if(this.pubsub.publish("events",t),"conversation_joined"===t.type){let i=e.Z.get(t,"data.conversation.members",[]);if(e.Z.find(i,(e=>e.id===this.kv.match("user").id))){await this.chain.reload(s,((e,t,i)=>this.listmessageapi(e,t,i))),this.markSync("events"+s);let{body:e}=await this.api.getConversation(s);e&&(r=e,this._setConvo(r)),this.pubsub.publish("account")}}return"message_sent"===t.type&&e.Z.get(t,"by.id")!==i.id&&this.api.markAsReceived(s,t.id),e.Z.startsWith(t.type,"message_")||e.Z.startsWith(t.type,"conversation_")?(this.restConvoEvent(t),void("message_sent"===t.type&&e.Z.get(t,"by.id")!==i.id&&Z("SUBIZ Chat","Received","User"))):void 0}}async restConvoEvent(t){let i=this.kv.match("user"),n=e.Z.convoOfEv(t),r=this.cache.match("convo_"+n)||{};if("conversation_state_updated"===t.type){if(!e.Z.get(r,"id")){let{body:e,error:t}=await this.api.getConversation(n);if(t)return}r=Object.assign(r,e.Z.get(t,"data.conversation"))}if("message_pong"===t.type){var s=e.Z.get(t,"data.message.id"),o=this.chain.match(n,s);if(!e.Z.get(o,"data.message"))return;var a=e.Z.get(o,"data.message.pongs",[]);a=a.concat(e.Z.get(t,"data.message.pongs",[])),o.data.message.pongs=a,e.Z.map(a,(t=>{t.member_id==i.id&&"seen"===t.type&&(e.Z.find(r.members,(e=>e.id===i.id)).seen_at=t.created)})),this.chain.put(n,o.id,e.Z.getMs(o.created),o)}if("message_sent"===t.type){let i=e.Z.getMsgField(t,"idempotency"),s=e.Z.find(this.listEvents(n),(e=>e.id===i));s&&(this.chain.del(n,s.id),t.created=s.created),r.last_message_sent=t}"message_pong"!==t.type&&"conversation_typing"!==t.type&&this.chain.put(n,t.id,e.Z.getMs(t.created),t),r.last_event=t,this._setConvo(r),this.pubsub.publish("account")}handleFormSubmit(t,i){if("message_sent"!==i.type)return;let n=[],r=e.Z.get(i,"data.message.attachments")||[];e.Z.each(r,(e=>{e&&"form_submit"===e.type&&n.push(e.form_submit)})),e.Z.each(n,(i=>{let n=e.Z.get(this.convoEventM,t+"."+i.form_message_id);if(!n)return;let r=e.Z.filter(e.Z.get(n,"data.message.attachments"),(e=>!!e&&("form"===e.type||"ask_info_form"===e.type)));e.Z.each(r,(t=>{t=t.form,e.Z.each(t.fields,(t=>{e.Z.each(i.fields,(e=>{t.name===e.name&&(t.default_answer||(t.default_answer=e.value))}))}))})),e.Z.size(r)>0&&this.pubsub.publish("state.convoEventM",this.convoEventM,t)}))}typing(e){e&&this._typing(e)}async startConvo(e){await this.readyGate.entry(),this.convoGate.close(),e.source||(e.source=document.location.href);let{body:t,error:i}=await this.api.start(e);return this.convoGate.open(),i?{error:i}:(this._setConvo(t),{convo:t})}createPostback(e,t){return this.api.createPostback(e,t)}async sendConvoEvent(t,i,n){await this.readyGate.entry();var r=e.Z.randomString(36),s={id:r,by:{id:(this.kv.match("user")||{}).id,type:"user",device:{referrer:document.URL}},data:n,type:i,created:this.now()};e.Z.convoToEv(t,s);let o=[];if("message_sent"===i&&(e.Z.setMsgField(s,"idempotency",r),s.data.message.conversation_id=t,await _.map(s.data.message.attachments,2,(async(e,t)=>{var i;"file"===e.type&&e._file&&(o.push(e),w.includes(e._file.type)&&(e.url=await(i=e._file,new Promise((e=>{var t=new window.FileReader;t.onload=t=>{e(t.target.result)},t.readAsDataURL(i)})))))}))),this.onWs(s),await this.convoGate.entry(),await _.map(o,1,(async e=>{const{url:t,error:i}=await this.api.uploadToS3(e._file);s._error=i,e.url=t})),s._error)return this.onWs(s);let{body:a,error:c}=await this.api.sendConvoEvent(t,s);if(c)return s._error=c,void this.onWs(s);this.onWs(a),Z("SUBIZ Chat","Sent","User")}_setConvo(t){let i=this.kv.match("user");const n=e.Z.getIntegrationId(i.account_id);let r=e.Z.get(t,"integration.id","");if(!r||r!==n)return;let s={};if(e.Z.map(this.cache.all(),((e,t)=>{t.startsWith("convo_")&&(s[t]=e)})),e.Z.size(s)>18){s=e.Z.orderBy(e.Z.map(s),"created","desc");for(var o=18;o<e.Z.size(s);o++){let e=s[o];this.cache.del("convo_"+e.id)}}this.markSync(t.id),this.pubsub.publish("account"),this.cache.put("convo_"+t.id,t)}matchLastPluginRun(e){return(this.kv.match("plugin_run_logs")||{})[e]}matchLastBotRun(e){return(this.kv.match("bot_run_logs")||{})[e]}logBotRun(e){let t=this.matchSession(),i=this.kv.match("bot_run_logs")||{};i[e]={bot_id:e,created:this.now(),session_id:t.id},this.kv.put("bot_run_logs",i)}sendImpression(e){let t=this.kv.match("user")||{},i=this.kv.match("plugin_run_logs")||{},n=this.matchSession();return i[e]={web_plugin_id:e,created:this.now(),session_id:n.id},this.kv.put("plugin_run_logs",i),this.api.sendImpression({account_id:t.account_id,campaign_id:e,web_plugin_id:e,user_id:t.id,url:window.location.href,device:this.device,session_id:n.id})}sendConversion(t,i,n){let r=this.kv.match("user")||{},s={account_id:r.account_id,user_id:r.id,fields:i},o=this.kv.match("conversions")||{};return o[t]=!0,this.kv.put("conversions",o),this.api.sendConversion({account_id:r.account_id,web_plugin_id:t,campaign_id:t,user_id:e.Z.get(r,"id"),url:window.location.href,device:this.device,submission:s,impression_token:n,session_id:this.matchSession().id})}isConverted(e){return(this.kv.match("conversions")||{})[e]}async listmessageapi(t,i,n){let r=t,{body:s,code:o,error:a}=await this.api.listMessages(r,-n,i);if(a||200!==o)return[[],i,a];i=e.Z.get(e.Z.last(s),"id"),s=e.Z.map(s,(t=>(t.created=e.Z.getMs(t.created),{id:t.id,index:t.created,value:t})));let c=this.kv.match("user")||{};for(let t=0;t<s.length;t++){let i=s[t].value;if("message_sent"===i.type&&e.Z.get(i,"by.id")!==c.id){if(e.Z.find(e.Z.get(i,"data.message.pongs"),(e=>e.member_id===c.id)))break;this.api.markAsReceived(r,i.id);break}}return[s,i]}async loopTime(){let t=e.Z.Date.now();if(!e.Z.get(this.kv.match("user"),"id"))return setTimeout((()=>this.loopTime()),3e4);let{body:i,error:n}=await this.api.time();if(n)return setTimeout((()=>this.loopTime()),3e4);var r=Math.abs(e.Z.Date.now()-t)/2,s=new e.Z.Date(i).getTime()+r,o=e.Z.Date.now();this.timeDiff=Math.floor(s-o),setTimeout((()=>this.loopTime()),6e4)}replaceFileUrl(t){return t?e.Z.startsWith(t,"/")||e.Z.startsWith(t,"data:")?t:(e.Z.startsWith(t,"http://")||e.Z.startsWith(t,"https://")||e.Z.startsWith(t,"//")||(t=e.Z.trim(this.FileURL,"/")+"/"+e.Z.trimStart(t,"/")),t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace("https://file-subiz.com/",this.FileURL)).replace("http://file-subiz.com/",this.FileURL)).replace("https://file-v4.subiz.com/",this.FileURL)).replace("http://file-v4.subiz.com/",this.FileURL)).replace("https://filev4.subiz.com/",this.FileURL)).replace("http://filev4.subiz.com/",this.FileURL)).replace("https://filev4-1.subiz.com/",this.FileURL)).replace("http://filev4-1.subiz.com/",this.FileURL)).replace("https://file.subiz.com/",this.FileURL)).replace("http://file.subiz.com/",this.FileURL)).replace("https://file.mysubiz.com/",this.FileURL)).replace("http://file.mysubiz.com/",this.FileURL)):""}clearBrowserData(){e.Z.each(this.cookie.all(),((e,t)=>{(t||"").startsWith("__sb")&&this.cookie.remove(t)})),this.kv.destroy(),this.kv=new s.kv(new s.lsdb("sbz2020",this.inmem),"kv"),this.chain.destroy(),this.chain=new s.chain(new s.lsdb("cbz2020",!0),"ch")}destroy(){this._die=!0,this.clearBrowserData(),this.realtime&&this.realtime.stop(),this.readyGate.close()}}const w=["image/gif","image/jpeg","image/png","image/svg+xml"],k={data:{},get(e,t){return this.data[e]||t},set(e,t){return this.data[e]=e},all(){return this.data},remove(e){delete this.data[e]}},x=()=>!(!window.ga||!window.ga.getAll);function Z(e,t,i){document.dispatchEvent(new CustomEvent("subiz",{detail:{category:e,action:t,label:i}})),function(e,t,i){x()&&(window.ga.getAll()||[]).forEach((function(n){const r=n.get("name");window.ga(r+".send","event",e,t,i)}))}(e,t,i),function(e,t,i){window.fbq&&window.fbq("trackCustom",e,{action:t,label:i})}(e,t,i)}let C=(z=navigator.userAgent||navigator.vendor||window.opera,/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(z)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(z.substr(0,4)));var z;let S=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(navigator.userAgent);var A=r(6400);let O={},j=!1;function P(t,i,n,s){if(!n)throw"$div must is a valid html node";var o=document.createElement("div");o.id=t.id,n.appendChild(o);let a=T(t,e.Z.detectLang());var c,u=new e.Z.Gate,l=0,h="hold",d=this;this.getState=()=>h;var p=async function(){if(k)return;if("hold"!==h)return;if("popup"===t.type&&i.isConverted(t.id))return;let n=i.matchLastPluginRun(t.id);"chatbox"!==t.type&&"notification"!==t.type||(n=void 0),e.Z.checkRunConditions(t.initiative_frequency,t.conditions,n,i)&&(h="running",await d.update(t))};this.forceRunPopup=async()=>{e.Z.get(f,"current")?f.current.openPopup():w()};var f=(0,A.Vf)();let g=null,_=null,m=null,v=null;var y=e=>s.showWidget(e),b=()=>{l++,w()},w=async()=>{k||o&&("chatbox"===t.type&&(g||(g=(await r.e(712).then(r.bind(r,5712))).default),(0,A.sY)((0,A.h)(g,{destroy:k,plugin:t,store:i,ref:f,t:this.t}),o)),"popup"===t.type&&(_||(_=(await r.e(213).then(r.bind(r,8213))).default),(0,A.sY)((0,A.h)(_,{destroy:k,t:this.t,highlight:c,mobile:i.isMobile(),plugin:t,store:i,ref:f,pageIndex:l,nextPage:b,showWidget:y}),o)),"notification"===t.type&&(v||(v=(await r.e(605).then(r.bind(r,9605))).default),(0,A.sY)((0,A.h)(v,{destroy:k,t:this.t,mobile:i.isMobile(),plugin:t,store:i,ref:f}),o)),"contact"===t.type&&(m||(m=(await r.e(619).then(r.bind(r,9619))).default),(0,A.sY)((0,A.h)(m,{destroy:k,t:this.t,plugin:t,store:i,ref:f}),o)),u.open())};this.call=(e,t)=>u.entry().then((()=>f.current[e](t)));var k=!1;this.destroy=()=>{k=!0,(0,A.sY)(null,o),o.parentNode.removeChild(o)},this.highlight=e=>{c=e,w()},this.update=e=>{k||(t=e,"hold"!==h&&"finished"!==h&&w())};let x=t=>{if("debug"===a)return`{{${t}}}`;let i=e.Z.get(O,a,[]),n=e.Z.find(i,(e=>e.key===t));return e.Z.get(n,"message",t)},Z=i.matchAccount();x.i18n=e=>{if(!e)return"";let i=t.locale||Z.locale||"vi-VN";return i=i.replace("-","_"),e[a.replace("-","_")]||e[i]},x.locale=()=>a,this.forceDownloadLanguage=async()=>{await E(i,a,!0),this.update(t)},this.setLocale=async e=>a===e?e:(this.t=null,w(),a=T(t,e),await E(i,a),this.t=x,w(),a);let C={};e.Z.map(e.Z.get(t,"popup.pages"),(t=>{t&&e.Z.map(t.components,(e=>{"image"===e.type&&e.image&&e.image.url&&e.image.url.startsWith("http")&&(C[e.image.url]=!0)}))})),e.Z.size(C)>=0&&e.Z.map(C,((t,i)=>e.Z.preloadImg(i)));let z=e.Z.get(t,"triggers")||[{type:"after_pageview",after_pageview_sec:0,disabled:!1}];for(var S=0;S<e.Z.size(z);S++){var j=z[S];j&&(j.disabled||("exit_intent"===j.type&&e.Z.trackExitIntent(p),"area_clicked"===j.type&&e.Z.trackAreaClicked(j.area_clicked_css_selector,p),"scrolling_percentage"===j.type&&e.Z.trackScrollingPercentage(j.scrolling_percentage,p),"inactivity_duration"===j.type&&e.Z.trackInactivity(j.inactivity_sec,p),"after_pageview"===j.type&&e.Z.trackTimeOnPage(j.after_pageview_sec,p)))}this.update(t),E(i,a).then((()=>{this.t=x,this.update(t)}))}class M{constructor(t,i){this.refM={},this.lib=t,this.$div=i,this.pluginM={},this._destroy=!1,t.store.onHighlight({_isMounted:!0},((e,t)=>{let i=this.pluginM[e];i&&i.highlight(t)})),t.store.onUpdate({_isMounted:!0},(()=>{if(this._destroy)return;let n=this.lib.store.matchPlugin(),r=!1;e.Z.each(n,(e=>{if("chatbox"===e.type){if(r)return;r=!0}this.pluginM[e.id]?this.pluginM[e.id].update(e):this.pluginM[e.id]=new P(e,this.lib.store,i,t)})),e.Z.each(this.pluginM,((e,t)=>{n[t]||(this.pluginM[t].destroy(),delete this.pluginM[t])}))}));let n=this.lib.store.matchPlugin(),r=!1;e.Z.each(n,(e=>{if("chatbox"===e.type){if(r)return;r=!0}this.pluginM[e.id]||(this.pluginM[e.id]=new P(e,this.lib.store,i,t))}))}findChatbox(){var t=this.lib.store.matchPlugin();let i=e.Z.filter(this.pluginM,((e,i)=>"chatbox"===t[i].type));if(0===e.Z.size(i))return void console.error("no chatbox found.");let n=e.Z.find(i,(e=>"running"===e.getState()));if(n||(n=i[0]),n)return n;console.error("found no suitable chatbox to run.")}getCurrentView(){let e=this.findChatbox();if(e)return e.call("getCurrentView")}showCurrentChatbox(e){let t=this.findChatbox();t&&t.call("showWidget",e)}showCurrentGreeting(){let e=this.findChatbox();e&&e.call("showGreeting")}hideCurrentGreeting(){let e=this.findChatbox();e&&e.call("hideGreeting")}hideCurrentChatbox(){let e=this.findChatbox();e&&e.call("hideWidget")}forceUpdateLang(e){let t=this.pluginM[e];t&&t.forceDownloadLanguage()}forceRunPopup(e){let t=this.pluginM[e];t&&t.forceRunPopup(e)}setPluginLocale(e,t){let i=this.pluginM[e];if(i)return i.setLocale(t)}setCurrentChatboxLocale(e){let t=this.findChatbox();t&&t.setLocale(e)}destroy(){e.Z.map(this.pluginM,((e,t)=>{this.pluginM[t]||(this.pluginM[t].destroy(),delete this.pluginM[t])})),this._destroy=!0}}function E(t,i,n){if(j)return new Promise((e=>setTimeout((()=>E(t,i,n).then(e)),100)));let r;return j=!0,"debug"===i||O[i]&&!n?(j=!1,Promise.resolve()):t.getLocaleContent(i).then((t=>{j=!1,r=e.Z.get(t,"body.messages",[]),O[i]=r}))}const T=(t,i)=>{i||(i="");let n=e.Z.find(t.locales,(e=>e.toLowerCase().trim()===i.toLowerCase().trim()));return n?i:(n=e.Z.find(t.locales,(e=>(e=e.replace("-","_").split("_")[0].trim().toLowerCase())==i.replace("-","_").split("_")[0].trim().toLowerCase())),n||t.locale||"en-US")};function L(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var U=document.createElement("link");U.href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap",U.rel="stylesheet",document.head.append(U),e.Z.preloadWebfonts(["Roboto"],[400,500]);class q{constructor(t,i,n,r,s,o){L(this,"version",(()=>"4.4")),L(this,"setSetting",(e=>this.store.setSetting({account_setting:e}))),L(this,"getSetting",(t=>({account_setting:e.Z.cloneDeep(this.store.matchAccountSetting())}))),L(this,"getUser",(()=>e.Z.parseJSON(e.Z.stringify(this.store.matchUser())))),this.domGate=new e.Z.Gate,this.store=new b(t,i,n,r,s,o),window.sbz_store=this.store,this.subs=[],this.store.onConvoEvent({_isMounted:!0},(t=>e.Z.map(this.subs,(e=>e(t)))))}setLang(e){var t=new XMLHttpRequest;t.open("GET","https://api.sbz.vn/4.0/oldlang",!0),t.send()}toggleLangDebugMode(){var e=new XMLHttpRequest;e.open("GET","https://api.sbz.vn/4.0/oldlangdebug",!0),e.send()}async setAccount(e,t){await this.store.init(e),t||(t=document.body),this.pluginMgr=new M(this,t);let i=setInterval((()=>{t&&t.isConnected||(this.pluginMgr.destroy(),clearInterval(i))}),1e3);this.domGate.open()}_setAccount(e,t){return this.setAccount(e,t)}async updateUserAttributes(t){await this.store.setUser({attributes:t});var i=this.store.matchUser();return e.Z.cloneDeep(i.attributes)}async getUserAttributes(){await this.store.readyGate.entry();var t=this.store.matchUser();return e.Z.cloneDeep(e.Z.get(t,"attributes",[]))}async getWidgetCurrentView(){return await this.domGate.entry(),this.pluginMgr.getCurrentView()}expandWidget(e,t){return this.showWidget(e,t)}shrinkWidget(){return this.hideWidget()}async sendMessage(e,t){this.store.sendConvoEvent(e,"message_sent",{message:t})}startConvo(e){return this.store.startConvo(e)}async showGreeting(){await this.domGate.entry(),this.pluginMgr.showCurrentGreeting()}async hideGreeting(){await this.domGate.entry(),this.pluginMgr.hideCurrentGreeting()}async showWidget(e,t){await this.domGate.entry(),this.pluginMgr.showCurrentChatbox({view:e,cid:t})}async hideWidget(){await this.domGate.entry(),this.pluginMgr.hideCurrentChatbox()}async setLocale(e){return await this.domGate.entry(),this.pluginMgr.setCurrentChatboxLocale(e)}async setPluginLocale(e,t){return await this.domGate.entry(),this.pluginMgr.setPluginLocale(e,t)}_overrideDeviceType(e){this.store.overrideDeviceType(e)}_overridePlugin(e){this.store.overridePlugin(e)}_forceUpdateLang(e){this.pluginMgr.forceUpdateLang(e)}_highlight(e,t){this.store.highlight(e,t)}openPopup(e){this.pluginMgr.forceRunPopup(e)}unEvent(t){this.subs=e.Z.filter(this.subs,(e=>e!==t))}async countUnreadMessages(){return await this.domGate.entry(),this.store.matchUnread()}onEvent(t){this.subs=e.Z.filter(this.subs,(e=>e!==t)),this.subs.push(t)}overrideAccount(e){this.store.overrideAcc(e)}async overrideChatbox(t){await this.store.overrideChatbox(t),e.Z.get(t,"chatbox.greeting.greeting")&&this.pluginMgr.showCurrentGreeting()}}window.__sbz_WIDGET=q;const I=q;if(window._subiz_init_2094850928430&&!window._subiz_init_2094850928430_keep_loading)throw new Error("subiz have already initialized");window._subiz_init_2094850928430=!0,window._subiz_init_2094850928430_keep_loading=!1,r(7460);var R=r(4636),D=window._sbzaccid?"4.3":function(){if(window.sbz_v4)return!0;var e=document.getElementsByTagName("script");if("function"!=typeof window.subiz)return!1;for(var t of e)if(t&&t.src){if(-1!==t.src.indexOf(R.BaseURL))return!0;if(-1!==t.src.indexOf("https://widgetv4.subiz.com"))return!0;if(-1!==t.src.indexOf("https://widget.mysubiz.com"))return!0;if(-1!==t.src.indexOf("https://storage.googleapis.com/sbz"))return!0}return!1}()?"4.2":window.subiz_account_id&&window.subiz_account_id>0?"1":function(){var e=document.getElementsByTagName("script");if(!(window._sbzq instanceof Array))return!1;for(var t of e)if(t&&t.src){if(-1!==t.src.indexOf(R.BaseURL))return!0;if(-1!==t.src.indexOf("https://widgetv4.subiz.com"))return!0}return!1}()?"4.1":function(){if(!window._sbzq)return!1;var e=document.getElementsByTagName("script");for(var t of e)if(t&&t.src&&-1!==t.src.indexOf("static.subiz.com"))return!0;return!1}()?"2":void 0;if(!D)throw new Error("subiz cannot detect version");var W=new I(R.ApiURL,R.FileURL,R.RealtimeURL);function $(e){e=e||[];var t=[];if(Array.isArray(e))t=e;else{if("object"!=typeof e)return;for(var i=Object.keys(e),n=0;n<i.length;n++)t.push(e[i[n]])}if(!((e=t).length<1)){var r=e.shift();if("function"==typeof W[r])return W[r](...e)}}window.addEventListener("keydown",(function(e){"Escape"===e.key&&W.hideWidget()}));let G=window.document.title;!function e(t){let i;if(W.store&&W.store.matchUser()&&(i=W.store.matchUser().account_id),"acqnarufdnsdtthffcnh"==i)return;if("visible"===W.store.browserVisibility)return"dirty invisible"===t&&G===window.document.title&&(window.document.title=window.document.title.substr(4)),setTimeout(e,1e3,"visible");let n=W.store.matchUnread();return n?"dirty invisible"===t?(G===window.document.title&&(window.document.title=window.document.title.substr(4)),setTimeout(e,1e3,"dirty invisible blink")):(n>9&&(n="*"),window.document.title="("+n+") "+window.document.title,G=window.document.title,setTimeout(e,2e3,"dirty invisible")):("dirty invisible"===t&&G===window.document.title&&(window.document.title=window.document.title.substr(4)),setTimeout(e,1e3,"clean invisible"))}(),function(){if("1"!==D&&"2"!==D){if("1"===D&&W._setAccount(window.subiz_account_id),"2"===D||"4.1"===D){let e=window._sbzq||[];Array.isArray(e)||(e=[]),window._sbzq={push:$},e.forEach($)}if("4.2"===D||"4.3"===D){let e=window.subiz&&window.subiz.q||[];window.subiz=function(){return $(arguments)},e.forEach($)}W.store.readyGate.entry().then((function(){W.store.track(),function(t){let i=t.matchBot();0!==Object.keys(i).length&&e.Z.each(i,(i=>{let n=async()=>{if(n=()=>!0,!e.Z.checkRunConditions(i.initiative_frequency,i.conditions,t.matchLastBotRun(i.id),t))return;let{error:r}=await t.startConvo({initial_by:i.id,locale:e.Z.detectLang(),state:"active",members:[{type:"bot",id:i.id}]});if(r)return console.error(r);t.logBotRun(i.id)},r=e.Z.get(i,"triggers")||[];for(let t of r){if(!t)continue;if(t.disabled)continue;let i=n;"area_clicked"===t.type&&e.Z.trackAreaClicked(t.area_clicked_css_selector,i),"scrolling_percentage"===t.type&&e.Z.trackScrollingPercentage(t.scrolling_percentage,i),"inactivity_duration"===t.type&&e.Z.trackInactivity(t.inactivity_sec,i),"after_pageview"===t.type&&e.Z.trackTimeOnPage(t.after_pageview_sec,i)}}))}(W.store)}))}else console.error("DETECTED SUBIZ OUTDATED V3 EMBEDED CODE",v3accid,". Please visit https://subiz.com.vn for support")}()})()})();